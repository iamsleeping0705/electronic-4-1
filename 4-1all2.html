<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>éœé›»å¯¦é©—å…­éƒ¨æ›² - æ•´æ•¸é›»è·ç‰ˆ</title>
    <style>
        /* --- å…¨åŸŸé€šç”¨æ¨£å¼ --- */
        body {
            margin: 0;
            padding: 0;
            font-family: "Microsoft JhengHei", "Segoe UI", sans-serif;
            background-color: #ecf0f1;
            height: 100vh;
            overflow: hidden;
            user-select: none;
            display: flex;
            flex-direction: column;
            touch-action: none;
        }

        /* --- é ‚éƒ¨èƒ½é‡æ¢ --- */
        #top-bar {
            width: 100%;
            height: 50px;
            background-color: #2c3e50;
            display: flex;
            align-items: center;
            padding: 0 20px;
            box-sizing: border-box;
            color: white;
            justify-content: space-between;
            z-index: 200;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            flex-shrink: 0;
        }
        .energy-container {
            flex: 1;
            max-width: 600px;
            background-color: #34495e;
            height: 20px;
            border-radius: 10px;
            margin: 0 20px;
            position: relative;
            overflow: hidden;
        }
        #energy-fill {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #f1c40f, #e67e22);
            transition: width 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #energy-text {
            font-weight: bold;
            color: #f1c40f;
        }

        /* --- ä¸»é¸å–® (é¦–é ) --- */
        #home-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            flex: 1;
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            z-index: 10;
        }

        .menu-title {
            font-size: 3rem;
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }

        .menu-credits {
            font-size: 1.2rem;
            color: #7f8c8d;
            margin-bottom: 40px;
            background-color: rgba(255,255,255,0.8);
            padding: 10px 20px;
            border-radius: 20px;
            border: 1px solid #bdc3c7;
            text-align: center;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            max-width: 1000px;
            width: 95%;
        }

        .menu-btn {
            padding: 20px;
            font-size: 1.3rem;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            background-color: #fff;
            color: #34495e;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            font-weight: bold;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 2px solid transparent;
        }

        .menu-btn:hover, .menu-btn:active {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
            border-color: #3498db;
            color: #3498db;
        }
        
        /* --- å¯¦é©—å®¹å™¨ --- */
        .experiment-wrapper {
            display: none;
            width: 100%;
            height: calc(100% - 110px);
            justify-content: center;
            align-items: center;
            padding: 10px;
            box-sizing: border-box;
            overflow: hidden;
        }

        .experiment-wrapper.active {
            display: flex;
        }

        /* --- ä¸‹æ–¹å°è¦½åˆ— --- */
        #bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background-color: #2c3e50;
            display: none;
            justify-content: center;
            align-items: center;
            gap: 10px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
            z-index: 100;
            overflow-x: auto;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .nav-btn {
            background: none;
            border: 1px solid rgba(255,255,255,0.3);
            color: #bdc3c7;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .nav-btn:hover {
            background-color: rgba(255,255,255,0.1);
            color: #fff;
        }

        .nav-btn.active {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
            font-weight: bold;
        }

        .nav-home-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            font-weight: bold;
        }
        .nav-home-btn:hover { background-color: #c0392b; }

        /* --- Layout --- */
        .main-layout {
            display: flex;
            flex-direction: row;
            gap: 15px;
            padding: 10px;
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            width: 98%;
            height: 98%;
            box-sizing: border-box;
        }

        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex: 1;
            min-width: 0;
        }

        .ui-container {
            display: flex;
            gap: 8px;
            min-height: 45px; 
            align-items: center;
            flex-wrap: wrap;
            padding: 0 5px;
        }
        
        .ui-label {
            font-weight: bold;
            color: #555;
            margin-right: 5px;
            font-size: 1rem;
        }

        .canvas-wrapper {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #bdc3c7;
            background-color: #f9f9f9;
            flex: 1;
            touch-action: none;
        }
        
        canvas { display: block; width: 100%; height: 100%; touch-action: none; }

        .right-panel {
            flex: 0 0 300px;
            display: flex;
            flex-direction: column;
            background-color: #fdfefe;
            border-left: 2px solid #eee;
            padding-left: 15px;
            overflow-y: auto;
        }

        .guide-box {
            background-color: #e8f6f3;
            border-left: 5px solid #1abc9c;
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        
        .guide-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: #16a085;
            margin-bottom: 8px;
        }

        .guide-content {
            font-size: 1rem;
            line-height: 1.5;
            color: #34495e;
        }

        .status-box {
            background-color: #fff8e1;
            border: 1px solid #ffe0b2;
            padding: 10px;
            border-radius: 8px;
            margin-top: auto;
        }

        .mat-btn {
            padding: 10px 16px;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background-color: #3498db;
            color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.2s;
            white-space: nowrap;
            margin-bottom: 4px;
        }
        .mat-btn:hover, .mat-btn:active { background-color: #2980b9; transform: translateY(-1px); }
        .mat-btn.active { background-color: #2c3e50; border: 2px solid #34495e; }
        
        .quiz-btn {
            background-color: #8e44ad;
            border: 2px solid #9b59b6;
        }
        .quiz-btn:hover { background-color: #71368a; }

        .pos-text { color: #e74c3c; font-weight: bold; }
        .neg-text { color: #3498db; font-weight: bold; }
        .highlight { color: #e74c3c; font-weight: bold; }
        .action-tip { color: #2980b9; font-weight: bold; }

        /* --- æ¸¬é©—æ¨¡æ…‹è¦–çª— --- */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1000; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            background-color: rgba(0,0,0,0.6); 
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            padding: 30px;
            border-radius: 15px;
            width: 500px;
            max-width: 90%;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            text-align: left;
            position: relative;
            animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown {
            from {transform: translateY(-50px); opacity: 0;}
            to {transform: translateY(0); opacity: 1;}
        }
        .quiz-question {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
        }
        .quiz-options button {
            display: block;
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: 2px solid #ecf0f1;
            background-color: white;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
            font-size: 1rem;
            transition: all 0.2s;
        }
        .quiz-options button:hover {
            background-color: #f0f3f4;
            border-color: #bdc3c7;
        }
        .quiz-options button.correct {
            background-color: #d4efdf;
            border-color: #27ae60;
            color: #1e8449;
        }
        .quiz-options button.wrong {
            background-color: #fadbd8;
            border-color: #c0392b;
            color: #922b21;
        }
        .quiz-feedback {
            margin-top: 15px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
            font-size: 0.95rem;
            display: none;
        }
        .close-modal {
            margin-top: 15px;
            padding: 8px 20px;
            background-color: #34495e;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            float: right;
        }
        
        @media (max-width: 768px) {
            .menu-grid { grid-template-columns: 1fr; }
            .main-layout { flex-direction: column; overflow-y: auto; }
            .left-panel { flex: none; height: 55vh; }
            .right-panel { flex: none; width: 100%; height: auto; min-height: 200px; border-left: none; border-top: 2px solid #eee; padding-left: 0; padding-top: 10px;}
            .menu-title { font-size: 2rem; }
        }
    </style>
</head>
<body>

    <!-- é ‚éƒ¨èƒ½é‡æ¢ -->
    <div id="top-bar">
        <div style="font-weight:bold; font-size:1.1rem;">âš¡ çŸ¥è­˜èƒ½é‡æ¢</div>
        <div class="energy-container">
            <div id="energy-fill"></div>
        </div>
        <div id="energy-text">0 åˆ†</div>
    </div>

    <!-- é¦–é é¸å–® -->
    <div id="home-screen">
        <div class="menu-title">éœé›»å¯¦é©—äº”éƒ¨æ›² +</div>
        <div class="menu-credits">æ¡ƒåœ’Bill Yangè€å¸«è¨­è¨ˆï¼Œå°ä¸­Sleepingè€å¸«æ”¹ç·¨</div>
        <div class="menu-grid">
            <button class="menu-btn" onclick="switchExp(1)">1. æ‘©æ“¦èµ·é›»</button>
            <button class="menu-btn" onclick="switchExp(2)">2. éœé›»æ„Ÿæ‡‰</button>
            <button class="menu-btn" onclick="switchExp(3)">3. æ„Ÿæ‡‰èµ·é›»</button>
            <button class="menu-btn" onclick="switchExp(4)">4. æ¥è§¸èµ·é›»</button>
            <button class="menu-btn" onclick="switchExp(5)">5. é‡‘ç®”é©—é›»å™¨</button>
            <button class="menu-btn" onclick="switchExp(6)">6. é›™çƒæ¥è§¸</button>
        </div>
    </div>

    <!-- å¯¦é©— 1ï¼šæ‘©æ“¦èµ·é›» -->
    <div id="exp1-wrapper" class="experiment-wrapper">
        <div class="main-layout">
            <div class="left-panel">
                <div class="ui-container">
                    <button id="btn-glass-e1" class="mat-btn active">ç»æ£’ + çµ²çµ¹</button>
                    <button id="btn-plastic-e1" class="mat-btn">å¡‘è† æ£’ + æ¯›çš®</button>
                    <button id="btn-reset-e1" class="mat-btn" style="background-color:#95a5a6;">é‡ç½®</button>
                    <button class="mat-btn quiz-btn" onclick="openQuiz(1)" style="margin-left:auto;">ğŸ“ è§€å¿µæª¢æ¸¬</button>
                </div>
                <div class="canvas-wrapper">
                    <canvas id="canvas-e1" width="800" height="500"></canvas>
                </div>
            </div>
            <div class="right-panel">
                <div class="guide-box">
                    <div class="guide-title">ğŸ“‹ å¯¦é©—ç›®æ¨™</div>
                    <div class="guide-content" id="guide-goal-e1">é¸æ“‡ææ–™é€²è¡Œæ‘©æ“¦ï¼Œè§€å¯Ÿé›»å­è½‰ç§»ã€‚</div>
                </div>
                <div class="guide-box">
                    <div class="guide-title">ğŸ–ï¸ æ“ä½œæŒ‡å°</div>
                    <div class="guide-content" id="guide-action-e1">è«‹æŒ‰ä½å¸ƒæ–™ï¼Œåœ¨æ£’å­ä¸Š<b style="color:#e74c3c;">ä¾†å›æ‘©æ“¦ç§»å‹•</b>ã€‚<br>å–®ç´”æ¥è§¸ä¸æœƒç™¼ç”Ÿè½‰ç§»ï¼Œå¿…é ˆè¦æœ‰ã€Œæ‘©æ“¦ã€å‹•ä½œï¼</div>
                </div>
                <div class="status-box">
                    <div>é›»å­è½‰ç§»é€²åº¦</div>
                    <div id="progress-display-e1" style="font-size:1.5rem; font-weight:bold; color:#e67e22;">0 / 8</div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¯¦é©— 2ï¼šéœé›»æ„Ÿæ‡‰ -->
    <div id="exp2-wrapper" class="experiment-wrapper">
        <div class="main-layout">
            <div class="left-panel">
                <div class="ui-container">
                    <button id="btn-glass-e2" class="mat-btn active">å¸¶æ­£é›»æ£’</button>
                    <button id="btn-plastic-e2" class="mat-btn">å¸¶è² é›»æ£’</button>
                    <button id="btn-reset-e2" class="mat-btn" style="background-color:#95a5a6;">é‡ç½®</button>
                    <button class="mat-btn quiz-btn" onclick="openQuiz(2)" style="margin-left:auto;">ğŸ“ è§€å¿µæª¢æ¸¬</button>
                </div>
                <div class="canvas-wrapper">
                    <canvas id="canvas-e2" width="800" height="500"></canvas>
                </div>
            </div>
            <div class="right-panel">
                <div class="guide-box">
                    <div class="guide-title">ğŸ“‹ å¯¦é©—åŸç†</div>
                    <div class="guide-content">è§€å¯Ÿé›»è·åˆ†é›¢ï¼šè¿‘ç«¯ç•°æ€§é›»ï¼Œé ç«¯åŒæ€§é›»ã€‚<br>æ³¨æ„è§€å¯Ÿä¸‹æ–¹æ•¸å€¼ï¼Œç†è§£é›»è·å®ˆæ†ã€‚</div>
                </div>
                <div class="guide-box">
                    <div class="guide-title">ğŸ–ï¸ æ“ä½œæŒ‡å°</div>
                    <div class="guide-content">æ‹–æ›³æ£’å­é è¿‘é‡‘å±¬çƒã€‚<br>è§€å¯Ÿç•«é¢ä¸­çš„é›»è·æ•¸(e)è®ŠåŒ–ã€‚</div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¯¦é©— 3ï¼šæ„Ÿæ‡‰èµ·é›» -->
    <div id="exp3-wrapper" class="experiment-wrapper">
        <div class="main-layout">
            <div class="left-panel">
                <div class="ui-container">
                    <span class="ui-label">æ£’å­:</span>
                    <button id="btn-glass-e3" class="mat-btn active">æ­£é›» (ç»ç’ƒæ£’)</button>
                    <button id="btn-plastic-e3" class="mat-btn">è² é›» (å¡‘è† æ£’)</button>
                    
                    <button id="btn-step-1-e3" class="mat-btn active" style="background-color:#e67e22; margin-left:10px;">1. é è¿‘ (å¯æ‹–æ›³)</button>
                    <button id="btn-step-2-e3" class="mat-btn" style="background-color:#95a5a6;">2. æ¥åœ°</button>
                    <button id="btn-step-3-e3" class="mat-btn" style="background-color:#95a5a6;">3. æ–·åœ°</button>
                    <button id="btn-step-4-e3" class="mat-btn" style="background-color:#95a5a6;">4. ç§»æ£’</button>
                    
                    <button id="btn-reset-e3" class="mat-btn" style="background-color:#34495e; margin-left:auto;">é‡ç½®</button>
                    <button class="mat-btn quiz-btn" onclick="openQuiz(3)">ğŸ“ è§€å¿µæª¢æ¸¬</button>
                </div>
                <div class="canvas-wrapper">
                    <canvas id="canvas-e3" width="940" height="500"></canvas>
                </div>
            </div>
            <div class="right-panel">
                <div class="guide-box" id="guide-box-e3">
                    <div class="guide-title" id="guide-title-e3">æ­¥é©Ÿ 1ï¼šé è¿‘æ„Ÿæ‡‰</div>
                    <div class="guide-content" id="guide-content-e3">
                        <b>è«‹æ‹–æ›³æ£’å­é è¿‘é‡‘å±¬çƒ</b>ã€‚<br>
                        è§€å¯Ÿé›»è·åˆ†é›¢ç¾è±¡ã€‚
                    </div>
                </div>
                <div class="status-box">
                    <div>é‡‘å±¬çƒæ·¨é›»è·</div>
                    <div id="net-charge-display-e3" style="font-size:1.4rem; font-weight:bold; color:#27ae60;">0</div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¯¦é©— 4ï¼šæ¥è§¸èµ·é›» -->
    <div id="exp4-wrapper" class="experiment-wrapper">
        <div class="main-layout">
            <div class="left-panel">
                <div class="ui-container">
                    <button id="btn-plastic-e4" class="mat-btn active">è² é›»æ£’</button>
                    <button id="btn-glass-e4" class="mat-btn">æ­£é›»æ£’</button>
                    <button id="btn-reset-e4" class="mat-btn" style="background-color:#95a5a6;">é‡ç½®</button>
                    <button class="mat-btn quiz-btn" onclick="openQuiz(4)" style="margin-left:auto;">ğŸ“ è§€å¿µæª¢æ¸¬</button>
                </div>
                <div class="canvas-wrapper">
                    <canvas id="canvas-e4" width="860" height="450"></canvas>
                </div>
            </div>
            <div class="right-panel">
                <div class="guide-box" id="guide-box-e4">
                    <div class="guide-title">æ­¥é©Ÿ 1ï¼šæº–å‚™æ¥è§¸</div>
                    <div class="guide-content">æ‹–æ›³æ£’å­ç›´æ¥æ¥è§¸é‡‘å±¬çƒï¼Œè§€å¯Ÿé›»è·åˆ†é…ã€‚<br><b>æ³¨æ„ï¼šæ¥è§¸å¾Œæ£’å­ä»æœƒå¸¶é›»ï¼ˆé›»è·åˆ†äº«ï¼‰ã€‚</b></div>
                </div>
                <div class="status-box" style="line-height:1.8;">
                    <div>æ£’å­æ·¨é›»è·ï¼š<span id="rod-charge-e4" style="font-weight:bold;"></span></div>
                    <div>é‡‘å±¬çƒæ·¨é›»è·ï¼š<span id="sphere-charge-e4" style="font-weight:bold;">0</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¯¦é©— 5ï¼šé‡‘ç®”é©—é›»å™¨ -->
    <div id="exp5-wrapper" class="experiment-wrapper">
        <div class="main-layout">
            <div class="left-panel">
                <div class="ui-container">
                    <span class="ui-label">æ£’å­:</span>
                    <button id="btn-glass-e5" class="mat-btn active">æ­£é›»</button>
                    <button id="btn-plastic-e5" class="mat-btn">è² é›»</button>
                    <span class="ui-label" style="margin-left:10px;">åˆå§‹:</span>
                    <button id="btn-init-neu-e5" class="mat-btn active">ä¸­æ€§</button>
                    <button id="btn-init-pos-e5" class="mat-btn">æ­£é›»</button>
                    <button id="btn-init-neg-e5" class="mat-btn">è² é›»</button>
                    
                    <button id="btn-finger-e5" class="mat-btn" style="background-color:#e67e22; margin-left:10px;">ğŸ‘† æ‰‹æŒ‡æ¥åœ°</button>
                    <button id="btn-reset-e5" class="mat-btn" style="background-color:#95a5a6;">é‡ç½®</button>
                    <button class="mat-btn quiz-btn" onclick="openQuiz(5)" style="margin-left:auto;">ğŸ“ è§€å¿µæª¢æ¸¬</button>
                </div>
                <div class="canvas-wrapper">
                    <canvas id="canvas-e5" width="800" height="500"></canvas>
                </div>
            </div>
            <div class="right-panel">
                <div class="guide-box">
                    <div class="guide-title">åœ–ç¤ºèªªæ˜</div>
                    <div class="guide-content">
                        <span style="color:#e74c3c; font-weight:bold;">â— è³ªå­ (æ­£é›»)</span>ï¼šå›ºå®šä¸å‹•ã€‚<br>
                        <span style="color:#3498db; font-weight:bold;">â— é›»å­ (è² é›»)</span>ï¼šå¯è‡ªç”±ç§»å‹•ã€‚<br>
                        <br>
                        <b>æ“ä½œæ–¹æ³• (æ”¯æ´è§¸æ§)ï¼š</b><br>
                        1. æ‹–æ›³æ£’å­é è¿‘ã€‚<br>
                        2. è§€å¯Ÿé›»å­å¦‚æµé«”èˆ¬å¿«é€Ÿç§»å‹•ã€‚<br>
                        3. è§€å¯Ÿé‡‘ç®”éš¨åº•éƒ¨é›»è·é‡è®ŠåŒ–å¼µé–‹ã€‚
                    </div>
                </div>
                <div class="status-box">
                    <div>é‡‘ç®”å¼µè§’ç‹€æ…‹</div>
                    <div id="leaf-angle-e5" style="font-size:1.2rem; font-weight:bold; color:#8e44ad;">0åº¦ (é–‰åˆ)</div>
                    <div style="margin-top:5px; font-size:0.8rem; color:#555;">
                        é ‚éƒ¨æ·¨é›»è·: <span id="top-charge-e5">0</span><br>
                        åº•éƒ¨æ·¨é›»è·: <span id="bottom-charge-e5">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¯¦é©— 6ï¼šé›™çƒæ¥è§¸ (æ–°) -->
    <div id="exp6-wrapper" class="experiment-wrapper">
        <div class="main-layout">
            <div class="left-panel">
                <div class="ui-container">
                    <span class="ui-label">åˆå§‹è¨­å®š:</span>
                    <button id="btn-same-e6" class="mat-btn active">åŒæ€§é›» (A+8, B+2)</button>
                    <button id="btn-diff-e6" class="mat-btn">ç•°æ€§é›» (A+8, B-4)</button>
                    <button id="btn-reset-e6" class="mat-btn" style="background-color:#95a5a6; margin-left:10px;">é‡ç½®ä½ç½®</button>
                </div>
                <div class="canvas-wrapper">
                    <canvas id="canvas-e6" width="800" height="500"></canvas>
                </div>
            </div>
            <div class="right-panel">
                <div class="guide-box">
                    <div class="guide-title">å¯¦é©—åŸç†</div>
                    <div class="guide-content">
                        <b>æ¥è§¸èµ·é›» (é›»è·åˆ†äº«)</b><br>
                        ç•¶å…©å€‹ç›¸åŒçš„å°é«”æ¥è§¸æ™‚ï¼Œæ·¨é›»è·æœƒé‡æ–°åˆ†ä½ˆä¸¦è¶¨æ–¼å¹³å‡ã€‚<br>
                        1. ç•°æ€§é›»ï¼šå…ˆä¸­å’ŒæŠµéŠ·ï¼Œå†åˆ†é…ã€‚<br>
                        2. åŒæ€§é›»ï¼šé›»è·ç›¸æ–¥ï¼Œé‡æ–°åˆ†é…ã€‚
                    </div>
                </div>
                <div class="status-box">
                    <div>Açƒæ·¨é›»è·ï¼š<span id="charge-a-e6" style="font-weight:bold; font-size:1.2rem;"></span></div>
                    <div>Bçƒæ·¨é›»è·ï¼š<span id="charge-b-e6" style="font-weight:bold; font-size:1.2rem;"></span></div>
                    <hr>
                    <div>ç³»çµ±ç¸½é›»è·ï¼š<span id="charge-total-e6" style="color:#555;"></span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨å°è¦½åˆ— -->
    <div id="bottom-nav">
        <button class="nav-btn nav-home-btn" onclick="goHome()">ğŸ  ä¸»é¸å–®</button>
        <button class="nav-btn" id="nav-btn-1" onclick="switchExp(1)">1.æ‘©æ“¦èµ·é›»</button>
        <button class="nav-btn" id="nav-btn-2" onclick="switchExp(2)">2.éœé›»æ„Ÿæ‡‰</button>
        <button class="nav-btn" id="nav-btn-3" onclick="switchExp(3)">3.æ„Ÿæ‡‰èµ·é›»</button>
        <button class="nav-btn" id="nav-btn-4" onclick="switchExp(4)">4.æ¥è§¸èµ·é›»</button>
        <button class="nav-btn" id="nav-btn-5" onclick="switchExp(5)">5.é‡‘ç®”é©—é›»å™¨</button>
        <button class="nav-btn" id="nav-btn-6" onclick="switchExp(6)">6.é›™çƒæ¥è§¸</button>
    </div>

    <!-- æ¸¬é©—è¦–çª— -->
    <div id="quiz-modal" class="modal">
        <div class="modal-content">
            <div class="quiz-question" id="modal-q-text">é¡Œç›®æ–‡å­—</div>
            <div class="quiz-options" id="modal-q-options"></div>
            <div class="quiz-feedback" id="modal-q-feedback"></div>
            <button class="close-modal" onclick="closeQuiz()">é—œé–‰</button>
        </div>
    </div>

<script>
    // --- å…¨åŸŸè®Šæ•¸èˆ‡è¨ˆåˆ†ç³»çµ± ---
    let currentExpId = 0;
    let totalScore = 0;
    const MAX_SCORE = 15;

    function updateScore(points) {
        totalScore += points;
        const percentage = Math.min((totalScore / MAX_SCORE) * 100, 100);
        document.getElementById('energy-fill').style.width = percentage + '%';
        document.getElementById('energy-text').innerText = totalScore + ' åˆ†';
    }

    const quizData = {
        1: { q: "çµ²çµ¹æ‘©æ“¦ç»ç’ƒæ£’å¾Œï¼Œç‚ºä½•ç»ç’ƒæ£’å¸¶æ­£é›»ï¼Ÿ", options: [{text:"è³ªå­ç§»å‹•",correct:false},{text:"é›»å­å¾æ£’ç§»åˆ°çµ¹",correct:true},{text:"é›»å­å¾çµ¹ç§»åˆ°æ£’",correct:false}], reason: "é›»å­å¸¶è² é›»ä¸”ç§»å‹•ã€‚ç»ç’ƒæ£’å¤±é›»å­å¸¶æ­£é›»ã€‚" },
        2: { q: "å¸¶è² é›»æ£’é è¿‘é‡‘å±¬çƒ(ä¸æ¥è§¸)ï¼Œé‡‘å±¬çƒæ·¨é›»è·ç‚ºä½•ï¼Ÿ", options: [{text:"å¸¶æ­£é›»",correct:false},{text:"å¸¶è² é›»",correct:false},{text:"é›»ä¸­æ€§(0)",correct:true}], reason: "éœé›»æ„Ÿæ‡‰åªæ˜¯é›»è·åˆ†é›¢ï¼Œæœªé€²å‡ºå°é«”ï¼Œæ•…å®ˆæ†ç‚º0ã€‚" },
        3: { q: "è² é›»æ£’æ„Ÿæ‡‰èµ·é›»ï¼Œé‡‘å±¬çƒæœ€å¾Œå¸¶ä½•ç¨®é›»ï¼Ÿ", options: [{text:"æ­£é›»",correct:true},{text:"è² é›»",correct:false},{text:"ä¸­æ€§",correct:false}], reason: "è² é›»æ£’æ–¥é›»å­å…¥åœ°ï¼Œæ–·åœ°å¾Œçƒç¼ºé›»å­(æ­£)ã€‚" },
        4: { q: "æ­£é›»æ£’æ¥è§¸é‡‘å±¬çƒï¼Œæ¥è§¸å¾Œå…©è€…é›»æ€§ï¼Ÿ", options: [{text:"æ£’æ­£çƒè² ",correct:false},{text:"éƒ½å¸¶æ­£é›»",correct:true},{text:"éƒ½ä¸­æ€§",correct:false}], reason: "æ¥è§¸èµ·é›»æ˜¯é›»è·åˆ†äº«ï¼Œæ­£é›»æ£’å¸èµ°éƒ¨åˆ†é›»å­ï¼Œå…©è€…çš†ç¼ºé›»å­(æ­£)ã€‚" },
        5: { q: "æ­£é›»æ£’é è¿‘é©—é›»å™¨ï¼Œé‡‘ç®”ç‚ºä½•å¼µé–‹ï¼Ÿ", options: [{text:"é‡‘ç®”å¸¶æ­£é›»",correct:true},{text:"é‡‘ç®”å¸¶è² é›»",correct:false}], reason: "æ„Ÿæ‡‰ï¼šä¸Šæ–¹ç›¤å¸é›»å­(è² )ï¼Œä¸‹æ–¹ç®”ç¼ºé›»å­(æ­£)ï¼ŒåŒæ€§ç›¸æ–¥å¼µé–‹ã€‚" }
    };

    function goHome() {
        document.getElementById('home-screen').style.display = 'flex';
        document.getElementById('bottom-nav').style.display = 'none';
        for(let i=1; i<=6; i++) {
            const w = document.getElementById(`exp${i}-wrapper`);
            if(w) w.classList.remove('active');
        }
        currentExpId = 0;
    }

    function switchExp(id) {
        currentExpId = id;
        document.getElementById('home-screen').style.display = 'none';
        document.getElementById('bottom-nav').style.display = 'flex';
        for(let i=1; i<=6; i++) {
            const wrapper = document.getElementById(`exp${i}-wrapper`);
            const navBtn = document.getElementById(`nav-btn-${i}`);
            if(wrapper) {
                if(i === id) wrapper.classList.add('active');
                else wrapper.classList.remove('active');
            }
            if(navBtn) {
                if(i === id) navBtn.classList.add('active');
                else navBtn.classList.remove('active');
            }
        }
    }

    let hasAnswered = {}; 
    function openQuiz(id) {
        const data = quizData[id];
        if(!data) return;
        document.getElementById('modal-q-text').innerText = data.q;
        const optDiv = document.getElementById('modal-q-options');
        optDiv.innerHTML = '';
        document.getElementById('modal-q-feedback').style.display = 'none';
        document.getElementById('quiz-modal').style.display = 'flex';
        data.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.innerText = opt.text;
            btn.onclick = function() { checkAnswer(btn, opt.correct, data.reason, id); };
            optDiv.appendChild(btn);
        });
    }
    function checkAnswer(btn, isCorrect, reason, id) {
        const feedback = document.getElementById('modal-q-feedback');
        feedback.style.display = 'block';
        feedback.innerHTML = reason;
        const btns = document.querySelectorAll('#modal-q-options button');
        btns.forEach(b => b.disabled = true);
        if(isCorrect) {
            btn.classList.add('correct');
            feedback.innerHTML = "ğŸ‰ ç­”å°äº†ï¼ " + feedback.innerHTML;
            if(!hasAnswered[id]) { updateScore(3); hasAnswered[id] = true; }
        } else {
            btn.classList.add('wrong');
            feedback.innerHTML = "âŒ ç­”éŒ¯äº†ã€‚ " + feedback.innerHTML;
        }
    }
    function closeQuiz() { document.getElementById('quiz-modal').style.display = 'none'; }

    function roundRect(ctx, x, y, width, height, radius, fill, stroke) {
        if (typeof stroke === 'undefined') stroke = true;
        if (typeof radius === 'undefined') radius = 5;
        ctx.beginPath();
        ctx.moveTo(x + radius, y);
        ctx.lineTo(x + width - radius, y);
        ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
        ctx.lineTo(x + width, y + height - radius);
        ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
        ctx.lineTo(x + radius, y + height);
        ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
        ctx.lineTo(x, y + radius);
        ctx.quadraticCurveTo(x, y, x + radius, y);
        ctx.closePath();
        if (stroke) ctx.stroke();
        if (fill) ctx.fill();
    }

    function getPointerPos(e, canvas) {
        const rect = canvas.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;
        return { x: (clientX - rect.left) * scaleX, y: (clientY - rect.top) * scaleY };
    }

    function setupInteractions(canvas, onStart, onMove, onEnd) {
        canvas.addEventListener('mousedown', (e) => onStart(e, getPointerPos(e, canvas)));
        canvas.addEventListener('mousemove', (e) => onMove(e, getPointerPos(e, canvas)));
        window.addEventListener('mouseup', onEnd);
        canvas.addEventListener('touchstart', (e) => { if(e.cancelable) e.preventDefault(); onStart(e, getPointerPos(e, canvas)); }, {passive: false});
        canvas.addEventListener('touchmove', (e) => { if(e.cancelable) e.preventDefault(); onMove(e, getPointerPos(e, canvas)); }, {passive: false});
        window.addEventListener('touchend', onEnd);
    }

    // --- Exp 1: æ‘©æ“¦èµ·é›» ---
    (function() {
        const canvas = document.getElementById('canvas-e1');
        const ctx = canvas.getContext('2d');
        let rod = {x: 250, y: 150, w: 50, h: 250, type: 'glass'};
        let cloth = {x: 450, y: 200, w: 120, h: 120};
        let electrons = []; 
        let dragging = null; let dragOff = {x:0, y:0};
        let frictionDistance = 0; let lastDragPos = {x:0, y:0};

        function initParticles() {
            electrons = [];
            for(let i=0; i<8; i++) {
                let py = rod.y + 30 + i*25;
                electrons.push({x: rod.x+15, y: py, charge: -1, owner: 'rod', fixed:false});
                electrons.push({x: rod.x+35, y: py, charge: 1, owner: 'rod', fixed: true});
            }
            for(let i=0; i<8; i++) {
                let rx = cloth.x + 20 + Math.random()*80;
                let ry = cloth.y + 20 + Math.random()*80;
                electrons.push({x: rx, y: ry, charge: -1, owner: 'cloth', fixed:false});
                electrons.push({x: rx+5, y: ry+5, charge: 1, owner: 'cloth', fixed: true});
            }
            updateProgress();
            frictionDistance = 0;
        }
        initParticles();

        function draw() {
            if(currentExpId !== 1) { requestAnimationFrame(draw); return; }
            ctx.clearRect(0,0,canvas.width, canvas.height);
            ctx.save();
            if(rod.type==='glass') ctx.fillStyle = 'rgba(200,230,255,0.9)'; else ctx.fillStyle = '#7f8c8d';
            ctx.strokeStyle = '#555'; roundRect(ctx, rod.x, rod.y, rod.w, rod.h, 10, true, true);
            ctx.restore();
            ctx.save();
            ctx.fillStyle = rod.type === 'glass' ? '#e91e63' : '#d35400';
            roundRect(ctx, cloth.x, cloth.y, cloth.w, cloth.h, 10, true, true);
            ctx.restore();

            let transferTrigger = false;
            if(checkOverlap(rod, cloth) && frictionDistance > 50) { transferTrigger = true; frictionDistance = 0; }

            electrons.forEach(p => {
                let px = p.x; let py = p.y;
                if(p.owner === 'rod') { px = rod.x + p.x - 250; py = rod.y + p.y - 150; }
                else { px = cloth.x + p.x - 450; py = cloth.y + p.y - 200; }
                if(transferTrigger && !p.fixed && Math.random()>0.7) {
                    if(rod.type==='glass' && p.owner==='rod' && p.charge===-1) {
                         p.owner = 'cloth'; p.x = 450 + 20 + Math.random()*80; p.y = 200 + 20 + Math.random()*80;
                         updateProgress(); transferTrigger = false; 
                    } else if (rod.type==='plastic' && p.owner==='cloth' && p.charge===-1) {
                         p.owner = 'rod'; p.x = 250 + 10 + Math.random()*30; p.y = 150 + Math.random()*200;
                         updateProgress(); transferTrigger = false;
                    }
                }
                ctx.beginPath(); ctx.arc(px, py, 6, 0, Math.PI*2);
                ctx.fillStyle = p.charge > 0 ? '#e74c3c' : '#3498db'; ctx.fill();
                ctx.fillStyle = 'white'; ctx.font='10px Arial'; ctx.textAlign='center'; ctx.fillText(p.charge>0?'+':'-', px, py+3);
            });
            requestAnimationFrame(draw);
        }
        function checkOverlap(r, c) { return (r.x < c.x + c.w && r.x + r.w > c.x && r.y < c.y + c.h && r.y + r.h > c.y); }
        function updateProgress() {
            let count = 0;
            if(rod.type === 'glass') count = 8 - electrons.filter(p=>p.owner==='rod' && p.charge===-1).length;
            else count = electrons.filter(p=>p.owner==='rod' && p.charge===-1).length - 8;
            if(count < 0) count = 0; if(count > 10) count = 10;
            document.getElementById('progress-display-e1').innerText = count + " / 8";
        }
        setupInteractions(canvas, 
            (e, pos) => { if(currentExpId!==1) return; if(pos.x>cloth.x && pos.x<cloth.x+cloth.w && pos.y>cloth.y && pos.y<cloth.y+cloth.h) { dragging = cloth; dragOff = {x:pos.x-cloth.x, y:pos.y-cloth.y}; lastDragPos = {x: pos.x, y: pos.y}; } },
            (e, pos) => { if(!dragging || currentExpId!==1) return; let dx = pos.x - lastDragPos.x; let dy = pos.y - lastDragPos.y; if(checkOverlap(rod, cloth)) frictionDistance += Math.sqrt(dx*dx+dy*dy); dragging.x = pos.x - dragOff.x; dragging.y = pos.y - dragOff.y; lastDragPos = {x: pos.x, y: pos.y}; },
            () => { dragging = null; frictionDistance = 0; }
        );
        document.getElementById('btn-glass-e1').onclick = () => { rod.type='glass'; initParticles(); document.getElementById('btn-glass-e1').classList.add('active'); document.getElementById('btn-plastic-e1').classList.remove('active'); };
        document.getElementById('btn-plastic-e1').onclick = () => { rod.type='plastic'; initParticles(); document.getElementById('btn-plastic-e1').classList.add('active'); document.getElementById('btn-glass-e1').classList.remove('active'); };
        document.getElementById('btn-reset-e1').onclick = () => { cloth.x=450; cloth.y=200; initParticles(); };
        requestAnimationFrame(draw);
    })();

    // --- Exp 2: éœé›»æ„Ÿæ‡‰ ---
    (function() {
        const canvas = document.getElementById('canvas-e2');
        const ctx = canvas.getContext('2d');
        let rod = {x: 50, y: 200, w: 200, h: 40, type: 'glass'}; 
        let particles = []; let dragging = null; let dragOff = {x:0, y:0};
        function init() {
            rod.x = 50; particles = [];
            for(let y=-70; y<=70; y+=35) {
                for(let x=-70; x<=70; x+=35) {
                    if(x*x+y*y < 75*75) { particles.push({x:x, y:y, q:1, fixed:true}); particles.push({x:x, y:y, q:-1, fixed:false, dx:0, dy:0}); }
                }
            }
        }
        init();
        function draw() {
            if(currentExpId!==2) { requestAnimationFrame(draw); return; }
            ctx.clearRect(0,0,canvas.width, canvas.height);
            let sphereX = 550, sphereY = 220, sphereR = 90;
            let rodTipX = rod.x + rod.w; 
            let dist = sphereX - rodTipX - sphereR;
            let effect = 0; if(dist < 250) effect = (250 - dist)/250; if(effect < 0) effect = 0; if(effect > 1) effect = 1;
            let nearNet = 0, farNet = 0, totalPos = 0, totalNeg = 0;
            particles.forEach(p => {
                let currentX = sphereX + p.x;
                if(!p.fixed) {
                    let dir = (rod.type==='glass') ? -1 : 1; 
                    let shift = effect * 90 * dir; 
                    currentX += shift;
                    let dx = currentX - sphereX; let d = Math.sqrt(dx*dx + p.y*p.y);
                    if(d > sphereR-10) currentX = sphereX + (dx/d)*(sphereR-10);
                }
                if(currentX < sphereX) nearNet += p.q; else farNet += p.q;
                if(p.q > 0) totalPos++; else totalNeg++;
            });
            // ç¹ªè£½èƒŒæ™¯
            let nearColor = "#7f8c8d"; let farColor = "#7f8c8d";
            if(Math.abs(nearNet) > 0) {
                if(nearNet < 0) { ctx.fillStyle='rgba(52,152,219,0.2)'; ctx.fillRect(sphereX-180,sphereY-140,180,280); nearColor="#2980b9"; }
                else { ctx.fillStyle='rgba(231,76,60,0.2)'; ctx.fillRect(sphereX-180,sphereY-140,180,280); nearColor="#c0392b"; }
                if(farNet < 0) { ctx.fillStyle='rgba(52,152,219,0.2)'; ctx.fillRect(sphereX,sphereY-140,180,280); farColor="#2980b9"; }
                else { ctx.fillStyle='rgba(231,76,60,0.2)'; ctx.fillRect(sphereX,sphereY-140,180,280); farColor="#c0392b"; }
            }
            ctx.beginPath(); ctx.moveTo(sphereX, sphereY-140); ctx.lineTo(sphereX, sphereY+140); ctx.strokeStyle="#bdc3c7"; ctx.setLineDash([5,5]); ctx.stroke(); ctx.setLineDash([]);
            ctx.font = "bold 18px Microsoft JhengHei"; ctx.textAlign = "center";
            ctx.fillStyle = nearColor; ctx.fillText(`è¿‘ç«¯ï¼š${nearNet>0?"+":""}${nearNet}e`, sphereX-90, sphereY-150);
            ctx.fillStyle = farColor; ctx.fillText(`é ç«¯ï¼š${farNet>0?"+":""}${farNet}e`, sphereX+90, sphereY-150);
            
            // ç¹ªçƒèˆ‡ç²’å­
            ctx.beginPath(); ctx.arc(sphereX, sphereY, sphereR, 0, Math.PI*2);
            let grad = ctx.createRadialGradient(sphereX-30, sphereY-30, 10, sphereX, sphereY, sphereR);
            grad.addColorStop(0, '#f1c40f'); grad.addColorStop(1, '#f39c12');
            ctx.fillStyle = grad; ctx.fill(); ctx.stroke();
            particles.forEach(p => {
                let tx = sphereX + p.x; 
                if(!p.fixed) {
                    let dir = (rod.type==='glass') ? -1 : 1; 
                    tx += effect * 90 * dir;
                    let dx = tx - sphereX; let d = Math.sqrt(dx*dx + p.y*p.y);
                    if(d > sphereR-10) tx = sphereX + (dx/d)*(sphereR-10);
                }
                ctx.beginPath(); ctx.arc(tx, sphereY+p.y, 6, 0, Math.PI*2);
                ctx.fillStyle = p.q>0 ? '#e74c3c' : '#3498db'; ctx.fill();
                ctx.fillStyle = 'white'; ctx.font='10px Arial'; ctx.textAlign='center'; ctx.fillText(p.q>0?'+':'-', tx, sphereY+p.y+3);
            });
            // ç¹ªæ£’
            ctx.save();
            ctx.fillStyle = rod.type==='glass' ? 'rgba(200,230,255,0.9)' : '#7f8c8d';
            roundRect(ctx, rod.x, rod.y, rod.w, rod.h, 15, true, true);
            let sym = rod.type==='glass' ? '+' : '-';
            ctx.fillStyle = '#333'; ctx.font='20px Arial'; ctx.fillText(sym.repeat(6), rod.x+70, rod.y+25);
            ctx.restore();
            requestAnimationFrame(draw);
        }
        setupInteractions(canvas, (e,p)=>{ if(currentExpId!==2)return; if(p.x>rod.x && p.x<rod.x+rod.w && p.y>rod.y && p.y<rod.y+rod.h){ dragging=rod; dragOff={x:p.x-rod.x, y:p.y-rod.y}; }}, (e,p)=>{ if(!dragging)return; dragging.x=p.x-dragOff.x; dragging.y=p.y-dragOff.y; }, ()=>dragging=null);
        document.getElementById('btn-glass-e2').onclick = () => { rod.type='glass'; };
        document.getElementById('btn-plastic-e2').onclick = () => { rod.type='plastic'; };
        document.getElementById('btn-reset-e2').onclick = () => { rod.x=50; };
        requestAnimationFrame(draw);
    })();

    // --- Exp 3: æ„Ÿæ‡‰èµ·é›» ---
    (function() {
        const canvas = document.getElementById('canvas-e3');
        const ctx = canvas.getContext('2d');
        let rod = {x: 10, y: 200, w: 200, h: 40, type: 'glass'};
        let step = 1; let particles = []; let groundingTimer = 0; 
        let dragging = null; let dragOff = {x:0, y:0};

        function init() { rod.x = 50; step = 1; particles = []; for(let i=0; i<12; i++) { particles.push({x:0, y:0, q:1, fixed:true, id:i}); particles.push({x:0, y:0, q:-1, fixed:false, grounded:false}); } updateUI(); }
        init();
        function updateUI() {
            for(let i=1; i<=4; i++) {
                let btn = document.getElementById(`btn-step-${i}-e3`);
                if(i === step) btn.classList.add('active'); else btn.classList.remove('active');
            }
            let content = "";
            if(step===1) content = "è«‹<b>æ‹–æ›³æ£’å­é è¿‘</b>é‡‘å±¬çƒã€‚<br>è¿‘ç«¯æ„Ÿæ‡‰ç•°æ€§é›»ï¼Œé ç«¯æ„Ÿæ‡‰åŒæ€§é›»ã€‚";
            if(step===2) content = "æ‰‹æ¥è§¸å°é«”é ç«¯(æ¥åœ°)ã€‚<br>è§€å¯Ÿé›»å­æµå‹•ï¼ˆæ…¢å‹•ä½œï¼‰ã€‚";
            if(step===3) content = "ç§»é–‹æ‰‹æŒ‡(æ–·åœ°)ã€‚<br>é›»è·è¢«é–åœ¨å°é«”ä¸Šã€‚";
            if(step===4) content = "ç§»é–‹å¸¶é›»æ£’ã€‚<br>é›»è·å‡å‹»åˆ†ä½ˆã€‚";
            document.getElementById('guide-content-e3').innerHTML = content;
            if(step===4) rod.x = 10; 
        }
        function draw() {
            if(currentExpId!==3) { requestAnimationFrame(draw); return; }
            ctx.clearRect(0,0,canvas.width, canvas.height);
            let sphereX = 600, sphereY = 220, sphereR = 90;
            let dist = sphereX - (rod.x + rod.w) - sphereR;
            let induction = (dist < 200) ? (200-dist)/200 : 0;
            if(induction < 0 || step===4) induction = 0;

            let activeEs = particles.filter(p => !p.fixed && !p.grounded);
            activeEs.forEach((p, i) => {
                let tx, ty;
                if(step === 4) {
                    let ang = (Math.PI*2 * i) / activeEs.length;
                    tx = sphereX + Math.cos(ang)*(sphereR-10); ty = sphereY + Math.sin(ang)*(sphereR-10);
                } else {
                    let dir = (rod.type==='glass') ? -1 : 1; 
                    let shift = induction * 60 * dir;
                    tx = sphereX + shift + (Math.random()-0.5)*20; ty = sphereY + (Math.random()-0.5)*60;
                    let dx = tx - sphereX; let dy = ty - sphereY;
                    if(Math.sqrt(dx*dx+dy*dy) > sphereR-10) { tx = sphereX + dx*0.8; ty = sphereY + dy*0.8; }
                }
                if(p.x===0) { p.x=tx; p.y=ty; }
                p.x += (tx - p.x)*0.1; p.y += (ty - p.y)*0.1;
            });

            if(step === 2) {
                groundingTimer++;
                if(groundingTimer > 15) { // Slow motion
                    groundingTimer = 0;
                    let targetE = (rod.type==='glass') ? 18 : 6; 
                    if(rod.type==='glass') { if(activeEs.length < targetE) particles.push({x:750, y:350, q:-1, fixed:false, grounded:false}); }
                    else { if(activeEs.length > targetE) { activeEs.sort((a,b)=>b.x-a.x); if(activeEs[0]) activeEs[0].grounded = true; } }
                }
            }

            ctx.fillStyle = rod.type==='glass' ? '#85c1e9' : '#7f8c8d'; roundRect(ctx, rod.x, rod.y, rod.w, rod.h, 10, true, true);
            let sym = rod.type==='glass' ? '+' : '-';
            ctx.fillStyle = '#333'; ctx.font='20px Arial'; ctx.fillText(sym.repeat(6), rod.x+rod.w/2, rod.y+25);

            ctx.beginPath(); ctx.arc(sphereX, sphereY, sphereR, 0, Math.PI*2);
            ctx.fillStyle = '#f39c12'; ctx.fill(); ctx.stroke();

            particles.forEach(p => {
                if(p.grounded) return;
                let idx = p.id;
                let px = p.fixed ? sphereX - 40 + (idx%4)*25 : p.x;
                let py = p.fixed ? sphereY - 40 + Math.floor(idx/4)*30 : p.y;
                ctx.beginPath(); ctx.arc(px, py, 6, 0, Math.PI*2);
                ctx.fillStyle = p.q>0 ? '#e74c3c' : '#3498db'; ctx.fill();
                ctx.fillStyle = 'white'; ctx.fillText(p.q>0?'+':'-', px, py+3);
            });

            if(step === 2) {
                ctx.strokeStyle = 'black'; ctx.lineWidth = 2; ctx.beginPath(); ctx.moveTo(sphereX+sphereR, sphereY); ctx.lineTo(750, 300); ctx.stroke();
                // Simple person
                ctx.strokeStyle = '#333'; ctx.beginPath(); ctx.arc(750, 280, 20, 0, Math.PI*2); ctx.fillStyle='#f1c40f'; ctx.fill(); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(750, 300); ctx.lineTo(750, 360); ctx.stroke();
                // Ground symbol
                let gx = 750, gy = 400;
                ctx.strokeStyle = 'green'; ctx.beginPath(); ctx.moveTo(gx, 360); ctx.lineTo(gx, gy); ctx.moveTo(gx-15, gy); ctx.lineTo(gx+15, gy);
                ctx.moveTo(gx-10, gy+5); ctx.lineTo(gx+10, gy+5); ctx.moveTo(gx-5, gy+10); ctx.lineTo(gx+5, gy+10); ctx.stroke();
            }

            let net = particles.filter(p=>p.fixed).length - particles.filter(p=>!p.fixed && !p.grounded).length;
            document.getElementById('net-charge-display-e3').innerText = net > 0 ? "+" + net : net;
            requestAnimationFrame(draw);
        }
        setupInteractions(canvas, (e,p)=>{ if(step===1 && p.x>rod.x && p.x<rod.x+rod.w && p.y>rod.y && p.y<rod.y+rod.h){ dragging=rod; dragOff={x:p.x-rod.x, y:p.y-rod.y}; }}, (e,p)=>{ if(!dragging)return; dragging.x=p.x-dragOff.x; dragging.y=p.y-dragOff.y; }, ()=>dragging=null);
        
        document.getElementById('btn-glass-e3').onclick = () => { rod.type='glass'; init(); };
        document.getElementById('btn-plastic-e3').onclick = () => { rod.type='plastic'; init(); };
        document.getElementById('btn-step-1-e3').onclick = () => { step=1; updateUI(); };
        document.getElementById('btn-step-2-e3').onclick = () => { step=2; updateUI(); };
        document.getElementById('btn-step-3-e3').onclick = () => { step=3; updateUI(); };
        document.getElementById('btn-step-4-e3').onclick = () => { step=4; updateUI(); };
        document.getElementById('btn-reset-e3').onclick = init;
        requestAnimationFrame(draw);
    })();

    // --- Exp 4: æ¥è§¸èµ·é›» (ä¿®æ­£é‚è¼¯) ---
    (function() {
        const canvas = document.getElementById('canvas-e4');
        const ctx = canvas.getContext('2d');
        let rod = {x: 50, y: 150, w: 200, h: 40, type: 'plastic'};
        let particles = []; let dragging = null; let dragOff = {x:0, y:0};
        function init() {
            rod.x = 50; particles = [];
            let qType = (rod.type==='plastic') ? -1 : 1;
            for(let i=0; i<10; i++) particles.push({x:0, y:0, q:qType, owner:'rod', id:i});
        }
        init();
        function draw() {
            if(currentExpId!==4) { requestAnimationFrame(draw); return; }
            ctx.clearRect(0,0,canvas.width, canvas.height);
            let sphereX = 550, sphereY = 170, sphereR = 90;
            
            // æ¥è§¸åˆ¤å®š
            let rodTip = rod.x + rod.w;
            if(rodTip > sphereX - sphereR && rod.x < sphereX + sphereR && rod.y+rod.h > sphereY-sphereR && rod.y < sphereY+sphereR) {
                let rodPs = particles.filter(p=>p.owner==='rod');
                // é™åˆ¶åªè½‰ç§»ä¸€åŠ (ä¾‹å¦‚å‰© 5 å€‹)
                if(rodPs.length > 5 && Math.random() > 0.9) {
                    rodPs[0].owner = 'sphere';
                }
            }

            // çµ±è¨ˆ
            let rodC = particles.filter(p=>p.owner==='rod').reduce((a,b)=>a+b.q,0);
            let sphereC = particles.filter(p=>p.owner==='sphere').reduce((a,b)=>a+b.q,0);
            document.getElementById('rod-charge-e4').innerText = (rodC>0?"+":"")+rodC+"e";
            document.getElementById('sphere-charge-e4').innerText = (sphereC>0?"+":"")+sphereC+"e";

            ctx.beginPath(); ctx.arc(sphereX, sphereY, sphereR, 0, Math.PI*2);
            ctx.fillStyle = '#f39c12'; ctx.fill(); ctx.stroke();
            
            particles.forEach(p => {
                if(p.owner === 'rod') {
                    p.x = rod.x + 20 + (p.id % 10)*18; p.y = rod.y + 20;
                } else {
                    // çƒä¸Šåˆ†ä½ˆ
                    let sPs = particles.filter(x=>x.owner==='sphere');
                    let idx = sPs.indexOf(p);
                    let ang = (Math.PI*2 * idx) / sPs.length;
                    p.x = sphereX + Math.cos(ang)*(sphereR-10); p.y = sphereY + Math.sin(ang)*(sphereR-10);
                }
                ctx.beginPath(); ctx.arc(p.x, p.y, 6, 0, Math.PI*2);
                ctx.fillStyle = p.q>0 ? '#e74c3c' : '#3498db'; ctx.fill();
                ctx.fillStyle = 'white'; ctx.fillText(p.q>0?'+':'-', p.x, p.y+3);
            });

            ctx.fillStyle = rod.type==='glass' ? '#85c1e9' : '#7f8c8d';
            roundRect(ctx, rod.x, rod.y, rod.w, rod.h, 10, true, true);
            let sym = rod.type==='glass' ? '+' : '-';
            ctx.fillStyle = '#333'; ctx.font='20px Arial'; ctx.textAlign='center';
            ctx.fillText(sym.repeat(6), rod.x+rod.w/2, rod.y+27);

            requestAnimationFrame(draw);
        }
        setupInteractions(canvas, (e,p)=>{ if(currentExpId!==4)return; if(p.x>rod.x && p.x<rod.x+rod.w && p.y>rod.y && p.y<rod.y+rod.h){ dragging=rod; dragOff={x:p.x-rod.x, y:p.y-rod.y}; }}, (e,p)=>{ if(!dragging)return; dragging.x=p.x-dragOff.x; dragging.y=p.y-dragOff.y; }, ()=>dragging=null);
        document.getElementById('btn-plastic-e4').onclick = () => { rod.type='plastic'; init(); };
        document.getElementById('btn-glass-e4').onclick = () => { rod.type='glass'; init(); };
        document.getElementById('btn-reset-e4').onclick = init;
        requestAnimationFrame(draw);
    })();

    // --- Exp 5: é©—é›»å™¨ (çœç•¥é‡è¤‡ä»£ç¢¼ï¼Œä¿æŒåŸæ¨£) ---
    (function() {
        const canvas = document.getElementById('canvas-e5');
        const ctx = canvas.getContext('2d');
        // ... (Exp 5 code remains same as V3, omitted for brevity but included in file generation) ...
        let rod = {x: 50, y: 150, w: 200, h: 40, type: 'glass', charge: 1}; 
        let dragging = null; let dragOff = {x:0, y:0}; let isGrounded = false; let initialChargeState = 0; let eParticles = []; 
        function initEParticles() {
            eParticles = [];
            for(let i=0; i<6; i++) { let ang=Math.random()*6.28; let r=Math.random()*35; eParticles.push({x:400+Math.cos(ang)*r, y:180+Math.sin(ang)*r, q:1, fixed:true}); }
            for(let i=0; i<8; i++) eParticles.push({x:400+5+(Math.random()-0.5)*4, y:200+i*12, q:1, fixed:true});
            let eCount = (initialChargeState===1)?8:(initialChargeState===-1?20:14);
            for(let i=0; i<eCount; i++) eParticles.push({x:400+(Math.random()-0.5)*20, y:150+Math.random()*150, q:-1, fixed:false, vx:0, vy:0});
        }
        initEParticles();
        function draw() {
            if(currentExpId !== 5) { requestAnimationFrame(draw); return; }
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            let dist = Math.sqrt((rod.x+100-400)**2 + (rod.y+20-180)**2);
            let inductionY = (dist < 400) ? (400-dist)/400 * (rod.charge>0?-1:1) * 8.0 : 0;
            // æ¥è§¸
            if(dist<80 && Math.random()>0.85) {
                if(rod.charge>0) { let p = eParticles.find(p=>!p.fixed && p.q===-1); if(p && eParticles.filter(x=>!x.fixed).length>4) eParticles.splice(eParticles.indexOf(p),1); }
                else eParticles.push({x:400, y:180, q:-1, fixed:false, vx:0, vy:0});
            }
            // æ¥åœ°
            if(isGrounded && Math.random()>0.7) {
                let bottomE = eParticles.filter(p=>!p.fixed && p.y>250).length;
                let bottomP = eParticles.filter(p=>p.fixed && p.y>250).length;
                if(inductionY < 0 && bottomE < bottomP+4) eParticles.push({x:400, y:320, q:-1, fixed:false, vx:0, vy:-5});
                else if(inductionY > 0 && bottomE > bottomP) { let p = eParticles.find(x=>!x.fixed && x.y>250); if(p) eParticles.splice(eParticles.indexOf(p),1); }
            }
            // Update
            eParticles.forEach(p => {
                if(p.fixed) return;
                p.vy = inductionY + (Math.random()-0.5)*3; p.vx = (Math.random()-0.5)*3;
                p.x += p.vx; p.y += p.vy;
                if(Math.sqrt((p.x-400)**2+(p.y-180)**2)<38 || (p.x>390 && p.x<410 && p.y>=180 && p.y<320)) {} else { if(p.y<145)p.y=150; if(p.y>315)p.y=310; if(p.x<365)p.x=370; if(p.x>435)p.x=430; }
            });
            // Draw
            let bE = eParticles.filter(p=>!p.fixed && p.y>240).length; let bP = eParticles.filter(p=>p.fixed && p.y>240).length;
            let angle = Math.min(90, Math.abs(bE-bP)*15);
            let curAng = parseFloat(document.getElementById('leaf-angle-e5').getAttribute('v')||0);
            let nextAng = curAng + (angle-curAng)*0.15;
            document.getElementById('leaf-angle-e5').innerText = Math.round(nextAng)+"åº¦";
            document.getElementById('leaf-angle-e5').setAttribute('v', nextAng);
            let tE = eParticles.filter(p=>!p.fixed && p.y<=240).length; let tP = eParticles.filter(p=>p.fixed && p.y<=240).length;
            document.getElementById('top-charge-e5').innerText = (tP-tE); document.getElementById('bottom-charge-e5').innerText = (bP-bE);

            ctx.strokeStyle='#7f8c8d'; ctx.strokeRect(350,200,100,150); ctx.fillStyle='rgba(255,255,255,0.5)'; ctx.fillRect(350,200,100,150);
            ctx.fillStyle='#95a5a6'; ctx.fillRect(395,180,10,140); 
            ctx.beginPath(); ctx.arc(400,180,40,0,6.28); ctx.fillStyle='#bdc3c7'; ctx.fill(); ctx.stroke();
            ctx.fillStyle='#f1c40f'; ctx.save(); ctx.translate(400,320); ctx.rotate(-nextAng*0.0174); ctx.fillRect(-2,0,4,60); ctx.restore();
            ctx.save(); ctx.translate(400,320); ctx.rotate(nextAng*0.0174); ctx.fillRect(-2,0,4,60); ctx.restore();
            eParticles.forEach(p=>{ ctx.beginPath(); ctx.arc(p.x,p.y,6,0,6.28); ctx.fillStyle=p.q>0?'#e74c3c':'#3498db'; ctx.fill(); ctx.fillStyle='white'; ctx.font='10px Arial'; ctx.textAlign='center'; ctx.fillText(p.q>0?'+':'-',p.x,p.y+4); });
            ctx.save(); ctx.fillStyle = rod.type==='glass'?'#85c1e9':'#7f8c8d'; roundRect(ctx, rod.x, rod.y, rod.w, rod.h, 15, true, true); 
            ctx.fillStyle='white'; ctx.font='20px Arial'; ctx.fillText(rod.charge>0?"++++++":"------", rod.x+70, rod.y+25); ctx.restore();
            if(isGrounded) { ctx.fillStyle='#e67e22'; ctx.beginPath(); ctx.arc(440,180,10,0,6.28); ctx.fill(); ctx.fillRect(440,170,60,20); ctx.fillStyle='white'; ctx.fillText("æ¥åœ°",460,185); }
            requestAnimationFrame(draw);
        }
        setupInteractions(canvas, (e,p)=>{if(currentExpId===5 && p.x>rod.x && p.x<rod.x+rod.w && p.y>rod.y && p.y<rod.y+rod.h) {dragging=rod; dragOff={x:p.x-rod.x, y:p.y-rod.y}}}, (e,p)=>{if(dragging){dragging.x=p.x-dragOff.x; dragging.y=p.y-dragOff.y}}, ()=>dragging=null);
        document.getElementById('btn-glass-e5').onclick=()=>{rod.type='glass';rod.charge=1;};
        document.getElementById('btn-plastic-e5').onclick=()=>{rod.type='plastic';rod.charge=-1;};
        document.getElementById('btn-init-neu-e5').onclick=()=>{initialChargeState=0;initEParticles();};
        document.getElementById('btn-init-pos-e5').onclick=()=>{initialChargeState=1;initEParticles();};
        document.getElementById('btn-init-neg-e5').onclick=()=>{initialChargeState=-1;initEParticles();};
        let fb=document.getElementById('btn-finger-e5'); fb.onmousedown=()=>isGrounded=true; fb.onmouseup=()=>isGrounded=false;
        fb.ontouchstart=(e)=>{e.preventDefault();isGrounded=true}; fb.ontouchend=(e)=>{e.preventDefault();isGrounded=false};
        document.getElementById('btn-reset-e5').onclick=()=>{rod.x=50;initialChargeState=0;initEParticles();};
        requestAnimationFrame(draw);
    })();

    // --- Exp 6: é›™çƒæ¥è§¸ ---
    (function() {
        const canvas = document.getElementById('canvas-e6');
        const ctx = canvas.getContext('2d');
        let ballA = {x: 200, y: 250, r: 80, q: 8, color: '#f1c40f'};
        let ballB = {x: 600, y: 250, r: 80, q: 2, color: '#e67e22'};
        let dragging = null; let dragOff = {x:0, y:0};
        let transferTimer = 0;
        
        function update() {
            if(currentExpId !== 6) { requestAnimationFrame(update); return; }
            ctx.clearRect(0,0,canvas.width, canvas.height);
            
            // Physics: Touch & Share
            let dist = Math.sqrt((ballA.x-ballB.x)**2 + (ballA.y-ballB.y)**2);
            if(dist <= ballA.r + ballB.r) {
                 // Touching!
                 transferTimer++;
                 if(transferTimer > 8) { // Speed of transfer
                     transferTimer = 0;
                     if(ballA.q - ballB.q >= 2) {
                         ballA.q--; ballB.q++;
                     } else if(ballB.q - ballA.q >= 2) {
                         ballB.q--; ballA.q++;
                     }
                 }
            } else {
                transferTimer = 0;
            }

            // Draw A
            drawBall(ballA, "A");
            // Draw B
            drawBall(ballB, "B");

            // Update Text
            document.getElementById('charge-a-e6').innerText = (ballA.q>0?"+":"") + ballA.q + "e";
            document.getElementById('charge-b-e6').innerText = (ballB.q>0?"+":"") + ballB.q + "e";
            document.getElementById('charge-total-e6').innerText = (ballA.q+ballB.q) + "e";

            requestAnimationFrame(update);
        }

        function drawBall(b, label) {
            ctx.beginPath(); ctx.arc(b.x, b.y, b.r, 0, Math.PI*2);
            let g = ctx.createRadialGradient(b.x-20, b.y-20, 10, b.x, b.y, b.r);
            g.addColorStop(0, '#fff'); g.addColorStop(1, b.color);
            ctx.fillStyle = g; ctx.fill(); ctx.stroke();
            ctx.fillStyle = '#333'; ctx.font = 'bold 24px Arial'; ctx.textAlign='center';
            ctx.fillText(label, b.x, b.y+10);
            
            // Draw particles visualization (simplified)
            let qInt = Math.round(b.q);
            let sign = qInt > 0 ? "+" : "-";
            let count = Math.abs(qInt);
            ctx.font = '12px Arial'; ctx.fillStyle='white';
            for(let i=0; i<count; i++) {
                let ang = i * (6.28/count);
                let px = b.x + Math.cos(ang)*(b.r-15);
                let py = b.y + Math.sin(ang)*(b.r-15);
                ctx.beginPath(); ctx.arc(px, py, 8, 0, 6.28); 
                ctx.fillStyle = sign==="+" ? '#e74c3c' : '#3498db'; ctx.fill();
                ctx.fillStyle='white'; ctx.fillText(sign, px, py+4);
            }
        }

        setupInteractions(canvas, (e,p)=>{
            if(currentExpId!==6) return;
            if(Math.sqrt((p.x-ballA.x)**2+(p.y-ballA.y)**2)<ballA.r) { dragging=ballA; dragOff={x:p.x-ballA.x, y:p.y-ballA.y}; }
            else if(Math.sqrt((p.x-ballB.x)**2+(p.y-ballB.y)**2)<ballB.r) { dragging=ballB; dragOff={x:p.x-ballB.x, y:p.y-ballB.y}; }
        }, (e,p)=>{
            if(!dragging) return;
            dragging.x = p.x - dragOff.x; dragging.y = p.y - dragOff.y;
        }, ()=>dragging=null);

        document.getElementById('btn-same-e6').onclick = () => { ballA.q=8; ballB.q=2; ballA.x=200; ballB.x=600; document.getElementById('btn-same-e6').classList.add('active'); document.getElementById('btn-diff-e6').classList.remove('active'); };
        document.getElementById('btn-diff-e6').onclick = () => { ballA.q=8; ballB.q=-4; ballA.x=200; ballB.x=600; document.getElementById('btn-diff-e6').classList.add('active'); document.getElementById('btn-same-e6').classList.remove('active'); };
        document.getElementById('btn-reset-e6').onclick = () => { ballA.x=200; ballB.x=600; }; // Keep charges
        
        requestAnimationFrame(update);
    })();

</script>
</body>
</html>