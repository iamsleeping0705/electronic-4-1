<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>éœé›»å¯¦é©—äº”éƒ¨æ›² - è‡ªç”±äº’å‹•ç‰ˆ</title>
    <style>
        /* --- å…¨åŸŸé€šç”¨æ¨£å¼ --- */
        body {
            margin: 0;
            padding: 0;
            font-family: "Microsoft JhengHei", "Segoe UI", sans-serif;
            background-color: #ecf0f1;
            height: 100vh;
            overflow: hidden;
            user-select: none;
            display: flex;
            flex-direction: column;
            touch-action: none;
        }

        /* --- é ‚éƒ¨èƒ½é‡æ¢ --- */
        #top-bar {
            width: 100%;
            height: 50px;
            background-color: #2c3e50;
            display: flex;
            align-items: center;
            padding: 0 20px;
            box-sizing: border-box;
            color: white;
            justify-content: space-between;
            z-index: 200;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .energy-container {
            flex: 1;
            max-width: 600px;
            background-color: #34495e;
            height: 20px;
            border-radius: 10px;
            margin: 0 20px;
            position: relative;
            overflow: hidden;
        }
        #energy-fill {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #f1c40f, #e67e22);
            transition: width 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #energy-text {
            font-weight: bold;
            color: #f1c40f;
        }

        /* --- ä¸»é¸å–® (é¦–é ) --- */
        #home-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            flex: 1;
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            z-index: 10;
        }

        .menu-title {
            font-size: 3rem;
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }

        .menu-credits {
            font-size: 1.2rem;
            color: #7f8c8d;
            margin-bottom: 40px;
            background-color: rgba(255,255,255,0.8);
            padding: 10px 20px;
            border-radius: 20px;
            border: 1px solid #bdc3c7;
            text-align: center;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            max-width: 1000px;
            width: 95%;
        }

        .menu-btn {
            padding: 20px;
            font-size: 1.3rem;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            background-color: #fff;
            color: #34495e;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            font-weight: bold;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 2px solid transparent;
        }

        .menu-btn:hover, .menu-btn:active {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
            border-color: #3498db;
            color: #3498db;
        }
        
        /* --- å¯¦é©—å®¹å™¨ --- */
        .experiment-wrapper {
            display: none;
            width: 100%;
            height: calc(100vh - 110px);
            justify-content: center;
            align-items: center;
            padding: 10px;
            box-sizing: border-box;
            overflow: hidden;
        }

        .experiment-wrapper.active {
            display: flex;
        }

        /* --- ä¸‹æ–¹å°è¦½åˆ— --- */
        #bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background-color: #2c3e50;
            display: none;
            justify-content: center;
            align-items: center;
            gap: 10px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
            z-index: 100;
            overflow-x: auto;
            white-space: nowrap;
        }

        .nav-btn {
            background: none;
            border: 1px solid rgba(255,255,255,0.3);
            color: #bdc3c7;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .nav-btn:hover {
            background-color: rgba(255,255,255,0.1);
            color: #fff;
        }

        .nav-btn.active {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
            font-weight: bold;
        }

        .nav-home-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            font-weight: bold;
        }
        .nav-home-btn:hover { background-color: #c0392b; }

        /* --- Layout --- */
        .main-layout {
            display: flex;
            gap: 15px;
            padding: 15px;
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            max-width: 1300px;
            width: 98%;
            height: 98%;
        }

        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex: 0 0 70%;
        }

        .ui-container {
            display: flex;
            gap: 8px;
            min-height: 40px; 
            align-items: center;
            flex-wrap: wrap;
        }
        
        .ui-label {
            font-weight: bold;
            color: #555;
            margin-right: 5px;
            font-size: 0.9rem;
        }

        .canvas-wrapper {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #bdc3c7;
            background-color: #f9f9f9;
            flex: 1;
            touch-action: none;
        }
        
        canvas { display: block; cursor: default; width: 100%; height: 100%; touch-action: none; }

        .right-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: #fdfefe;
            border-left: 2px solid #eee;
            padding-left: 15px;
            min-width: 250px;
            overflow-y: auto;
        }

        .guide-box {
            background-color: #e8f6f3;
            border-left: 5px solid #1abc9c;
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        
        .guide-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: #16a085;
            margin-bottom: 8px;
        }

        .guide-content {
            font-size: 0.95rem;
            line-height: 1.5;
            color: #34495e;
        }

        .status-box {
            background-color: #fff8e1;
            border: 1px solid #ffe0b2;
            padding: 10px;
            border-radius: 8px;
            margin-top: auto;
        }

        .mat-btn {
            padding: 8px 12px;
            font-size: 0.9rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: #3498db;
            color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.2s;
            white-space: nowrap;
            margin-bottom: 4px;
        }
        .mat-btn:hover, .mat-btn:active { background-color: #2980b9; transform: translateY(-1px); }
        .mat-btn.active { background-color: #2c3e50; border: 2px solid #34495e; }
        
        .quiz-btn {
            background-color: #8e44ad;
            border: 2px solid #9b59b6;
        }
        .quiz-btn:hover { background-color: #71368a; }

        .pos-text { color: #e74c3c; font-weight: bold; }
        .neg-text { color: #3498db; font-weight: bold; }
        .highlight { color: #e74c3c; font-weight: bold; }
        .action-tip { color: #2980b9; font-weight: bold; }

        /* --- æ¸¬é©—æ¨¡æ…‹è¦–çª— --- */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1000; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            background-color: rgba(0,0,0,0.6); 
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            padding: 30px;
            border-radius: 15px;
            width: 500px;
            max-width: 90%;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            text-align: left;
            position: relative;
            animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown {
            from {transform: translateY(-50px); opacity: 0;}
            to {transform: translateY(0); opacity: 1;}
        }
        .quiz-question {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
        }
        .quiz-options button {
            display: block;
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: 2px solid #ecf0f1;
            background-color: white;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
            font-size: 1rem;
            transition: all 0.2s;
        }
        .quiz-options button:hover {
            background-color: #f0f3f4;
            border-color: #bdc3c7;
        }
        .quiz-options button.correct {
            background-color: #d4efdf;
            border-color: #27ae60;
            color: #1e8449;
        }
        .quiz-options button.wrong {
            background-color: #fadbd8;
            border-color: #c0392b;
            color: #922b21;
        }
        .quiz-feedback {
            margin-top: 15px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
            font-size: 0.95rem;
            display: none;
        }
        .close-modal {
            margin-top: 15px;
            padding: 8px 20px;
            background-color: #34495e;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            float: right;
        }
        
        @media (max-width: 768px) {
            .menu-grid { grid-template-columns: 1fr; }
            .main-layout { flex-direction: column; overflow-y: auto; }
            .left-panel { flex: none; height: 60vh; }
            .right-panel { flex: none; height: auto; min-height: 200px; border-left: none; border-top: 2px solid #eee; padding-left: 0; padding-top: 10px;}
            .menu-title { font-size: 2rem; }
        }
    </style>
</head>
<body>

    <!-- é ‚éƒ¨èƒ½é‡æ¢ -->
    <div id="top-bar">
        <div style="font-weight:bold; font-size:1.1rem;">âš¡ çŸ¥è­˜èƒ½é‡æ¢</div>
        <div class="energy-container">
            <div id="energy-fill"></div>
        </div>
        <div id="energy-text">0 åˆ†</div>
    </div>

    <!-- é¦–é é¸å–® -->
    <div id="home-screen">
        <div class="menu-title">éœé›»å¯¦é©—äº”éƒ¨æ›²</div>
        <div class="menu-credits">æ¡ƒåœ’Bill Yangè€å¸«è¨­è¨ˆï¼Œå°ä¸­Sleepingè€å¸«æ”¹ç·¨</div>
        <div class="menu-grid">
            <button class="menu-btn" onclick="switchExp(1)">1. æ‘©æ“¦èµ·é›»</button>
            <button class="menu-btn" onclick="switchExp(2)">2. éœé›»æ„Ÿæ‡‰</button>
            <button class="menu-btn" onclick="switchExp(3)">3. æ„Ÿæ‡‰èµ·é›»</button>
            <button class="menu-btn" onclick="switchExp(4)">4. æ¥è§¸èµ·é›»</button>
            <button class="menu-btn" onclick="switchExp(5)">5. é‡‘ç®”é©—é›»å™¨</button>
        </div>
    </div>

    <!-- å¯¦é©— 1ï¼šæ‘©æ“¦èµ·é›» -->
    <div id="exp1-wrapper" class="experiment-wrapper">
        <div class="main-layout">
            <div class="left-panel">
                <div class="ui-container">
                    <button id="btn-glass-e1" class="mat-btn active">ç»æ£’ + çµ²çµ¹</button>
                    <button id="btn-plastic-e1" class="mat-btn">å¡‘è† æ£’ + æ¯›çš®</button>
                    <button id="btn-reset-e1" class="mat-btn" style="background-color:#95a5a6;">é‡ç½®</button>
                    <button class="mat-btn quiz-btn" onclick="openQuiz(1)" style="margin-left:auto;">ğŸ“ è§€å¿µæª¢æ¸¬</button>
                </div>
                <div class="canvas-wrapper">
                    <canvas id="canvas-e1" width="800" height="500"></canvas>
                </div>
            </div>
            <div class="right-panel">
                <div class="guide-box">
                    <div class="guide-title">ğŸ“‹ å¯¦é©—ç›®æ¨™</div>
                    <div class="guide-content" id="guide-goal-e1">é¸æ“‡ææ–™é€²è¡Œæ‘©æ“¦ï¼Œè§€å¯Ÿé›»å­è½‰ç§»ã€‚</div>
                </div>
                <div class="guide-box">
                    <div class="guide-title">ğŸ–ï¸ æ“ä½œæŒ‡å°</div>
                    <div class="guide-content" id="guide-action-e1">è«‹æŒ‰ä½å¸ƒæ–™ï¼Œåœ¨æ£’å­ä¸Š<b style="color:#e74c3c;">ä¾†å›æ‘©æ“¦ç§»å‹•</b>ã€‚<br>å–®ç´”æ¥è§¸ä¸æœƒç™¼ç”Ÿè½‰ç§»ï¼Œå¿…é ˆè¦æœ‰ã€Œæ‘©æ“¦ã€å‹•ä½œï¼</div>
                </div>
                <div class="status-box">
                    <div>é›»å­è½‰ç§»é€²åº¦</div>
                    <div id="progress-display-e1" style="font-size:1.5rem; font-weight:bold; color:#e67e22;">0 / 8</div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¯¦é©— 2ï¼šéœé›»æ„Ÿæ‡‰ -->
    <div id="exp2-wrapper" class="experiment-wrapper">
        <div class="main-layout">
            <div class="left-panel">
                <div class="ui-container">
                    <button id="btn-glass-e2" class="mat-btn active">å¸¶æ­£é›»æ£’</button>
                    <button id="btn-plastic-e2" class="mat-btn">å¸¶è² é›»æ£’</button>
                    <button id="btn-reset-e2" class="mat-btn" style="background-color:#95a5a6;">é‡ç½®</button>
                    <button class="mat-btn quiz-btn" onclick="openQuiz(2)" style="margin-left:auto;">ğŸ“ è§€å¿µæª¢æ¸¬</button>
                </div>
                <div class="canvas-wrapper">
                    <canvas id="canvas-e2" width="800" height="500"></canvas>
                </div>
            </div>
            <div class="right-panel">
                <div class="guide-box">
                    <div class="guide-title">ğŸ“‹ å¯¦é©—åŸç†</div>
                    <div class="guide-content">è§€å¯Ÿé›»è·åˆ†é›¢ï¼šè¿‘ç«¯ç•°æ€§é›»ï¼Œé ç«¯åŒæ€§é›»ã€‚<br>æ³¨æ„è§€å¯Ÿä¸‹æ–¹æ•¸å€¼ï¼Œç†è§£é›»è·å®ˆæ†ã€‚</div>
                </div>
                <div class="guide-box">
                    <div class="guide-title">ğŸ–ï¸ æ“ä½œæŒ‡å°</div>
                    <div class="guide-content">æ‹–æ›³æ£’å­é è¿‘é‡‘å±¬çƒã€‚<br>è§€å¯Ÿç•«é¢ä¸­çš„é›»è·æ•¸(e)è®ŠåŒ–ã€‚</div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¯¦é©— 3ï¼šæ„Ÿæ‡‰èµ·é›» (è‡ªç”±äº’å‹•ç‰ˆ) -->
    <div id="exp3-wrapper" class="experiment-wrapper">
        <div class="main-layout">
            <div class="left-panel">
                <div class="ui-container">
                    <span class="ui-label">æ£’å­æè³ª:</span>
                    <button id="btn-glass-e3" class="mat-btn active">æ­£é›» (ç»ç’ƒæ£’)</button>
                    <button id="btn-plastic-e3" class="mat-btn">è² é›» (å¡‘è† æ£’)</button>
                    <div style="flex:1;"></div>
                    <button id="btn-reset-e3" class="mat-btn" style="background-color:#34495e;">é‡ç½®ä½ç½®</button>
                    <button class="mat-btn quiz-btn" onclick="openQuiz(3)" style="margin-left:auto;">ğŸ“ è§€å¿µæª¢æ¸¬</button>
                </div>
                <div class="canvas-wrapper">
                    <canvas id="canvas-e3" width="940" height="500"></canvas>
                </div>
            </div>
            <div class="right-panel">
                <div class="guide-box" id="guide-box-e3">
                    <div class="guide-title" id="guide-title-e3">è‡ªç”±æ“ä½œå¯¦é©—</div>
                    <div class="guide-content" id="guide-content-e3">
                        <b>1. é è¿‘ï¼š</b>æ‹–æ›³æ£’å­é è¿‘é‡‘å±¬çƒ (æ³¨æ„ï¼šä¸è¦æ¥è§¸ï¼)ã€‚<br>
                        <b>2. æ¥åœ°ï¼š</b>æ‹–æ›³å°äººå»è§¸æ‘¸é‡‘å±¬çƒå³å´ã€‚<br>
                        <b>3. æ–·åœ°ï¼š</b>å°‡å°äººæ‹–é›¢ã€‚<br>
                        <b>4. ç§»é–‹ï¼š</b>å°‡æ£’å­æ‹–é›¢ã€‚
                    </div>
                </div>
                <div class="status-box">
                    <div style="font-weight:bold; margin-bottom:5px;">ç›®å‰ç‹€æ…‹ï¼š<span id="guide-status-e3" style="color:#2980b9;">æº–å‚™ä¸­</span></div>
                    <div>é‡‘å±¬çƒæ·¨é›»è·ï¼š<span id="net-charge-display-e3" style="font-size:1.2rem; font-weight:bold; color:#27ae60;">0</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¯¦é©— 4ï¼šæ¥è§¸èµ·é›» -->
    <div id="exp4-wrapper" class="experiment-wrapper">
        <div class="main-layout">
            <div class="left-panel">
                <div class="ui-container">
                    <button id="btn-plastic-e4" class="mat-btn active">è² é›»æ£’</button>
                    <button id="btn-glass-e4" class="mat-btn">æ­£é›»æ£’</button>
                    <button id="btn-reset-e4" class="mat-btn" style="background-color:#95a5a6;">é‡ç½®</button>
                    <button class="mat-btn quiz-btn" onclick="openQuiz(4)" style="margin-left:auto;">ğŸ“ è§€å¿µæª¢æ¸¬</button>
                </div>
                <div class="canvas-wrapper">
                    <canvas id="canvas-e4" width="860" height="450"></canvas>
                </div>
            </div>
            <div class="right-panel">
                <div class="guide-box" id="guide-box-e4">
                    <div class="guide-title">æ­¥é©Ÿ 1ï¼šæº–å‚™æ¥è§¸</div>
                    <div class="guide-content">æ‹–æ›³æ£’å­ç›´æ¥æ¥è§¸é‡‘å±¬çƒï¼Œè§€å¯Ÿé›»è·åˆ†é…ã€‚</div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¯¦é©— 5ï¼šé‡‘ç®”é©—é›»å™¨ -->
    <div id="exp5-wrapper" class="experiment-wrapper">
        <div class="main-layout">
            <div class="left-panel">
                <div class="ui-container" style="flex-wrap: wrap; height: auto; padding-bottom: 5px;">
                    <span class="ui-label">æ£’å­:</span>
                    <button id="btn-glass-e5" class="mat-btn active">æ­£é›»</button>
                    <button id="btn-plastic-e5" class="mat-btn">è² é›»</button>
                    <span class="ui-label" style="margin-left:10px;">åˆå§‹:</span>
                    <button id="btn-init-neu-e5" class="mat-btn active">ä¸­æ€§</button>
                    <button id="btn-init-pos-e5" class="mat-btn">æ­£é›»</button>
                    <button id="btn-init-neg-e5" class="mat-btn">è² é›»</button>
                    
                    <button id="btn-finger-e5" class="mat-btn" style="background-color:#e67e22; margin-left:10px;">ğŸ‘† æ‰‹æŒ‡æ¥åœ°</button>
                    <button id="btn-reset-e5" class="mat-btn" style="background-color:#95a5a6;">é‡ç½®</button>
                    <button class="mat-btn quiz-btn" onclick="openQuiz(5)" style="margin-left:auto;">ğŸ“ è§€å¿µæª¢æ¸¬</button>
                </div>
                <div class="canvas-wrapper">
                    <canvas id="canvas-e5" width="800" height="500"></canvas>
                </div>
            </div>
            <div class="right-panel">
                <div class="guide-box">
                    <div class="guide-title">åœ–ç¤ºèªªæ˜</div>
                    <div class="guide-content">
                        <span style="color:#e74c3c; font-weight:bold;">â— è³ªå­ (æ­£é›»)</span>ï¼šå›ºå®šä¸å‹•ã€‚<br>
                        <span style="color:#3498db; font-weight:bold;">â— é›»å­ (è² é›»)</span>ï¼šå¯è‡ªç”±ç§»å‹•ã€‚<br>
                        <br>
                        <b>æ“ä½œæ–¹æ³• (æ”¯æ´è§¸æ§)ï¼š</b><br>
                        1. æ‹–æ›³æ£’å­é è¿‘ã€‚<br>
                        2. è§€å¯Ÿé›»å­å¦‚æµé«”èˆ¬å¿«é€Ÿç§»å‹•ã€‚<br>
                        3. è§€å¯Ÿé‡‘ç®”éš¨åº•éƒ¨é›»è·é‡è®ŠåŒ–å¼µé–‹ã€‚
                    </div>
                </div>
                <div class="status-box">
                    <div>é‡‘ç®”å¼µè§’ç‹€æ…‹</div>
                    <div id="leaf-angle-e5" style="font-size:1.2rem; font-weight:bold; color:#8e44ad;">0åº¦ (é–‰åˆ)</div>
                    <div style="margin-top:5px; font-size:0.8rem; color:#555;">
                        é ‚éƒ¨æ·¨é›»è·: <span id="top-charge-e5">0</span><br>
                        åº•éƒ¨æ·¨é›»è·: <span id="bottom-charge-e5">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨å°è¦½åˆ— -->
    <div id="bottom-nav">
        <button class="nav-btn nav-home-btn" onclick="goHome()">ğŸ  ä¸»é¸å–®</button>
        <button class="nav-btn" id="nav-btn-1" onclick="switchExp(1)">1.æ‘©æ“¦èµ·é›»</button>
        <button class="nav-btn" id="nav-btn-2" onclick="switchExp(2)">2.éœé›»æ„Ÿæ‡‰</button>
        <button class="nav-btn" id="nav-btn-3" onclick="switchExp(3)">3.æ„Ÿæ‡‰èµ·é›»</button>
        <button class="nav-btn" id="nav-btn-4" onclick="switchExp(4)">4.æ¥è§¸èµ·é›»</button>
        <button class="nav-btn" id="nav-btn-5" onclick="switchExp(5)">5.é‡‘ç®”é©—é›»å™¨</button>
    </div>

    <!-- æ¸¬é©—è¦–çª— -->
    <div id="quiz-modal" class="modal">
        <div class="modal-content">
            <div class="quiz-question" id="modal-q-text">é¡Œç›®æ–‡å­—</div>
            <div class="quiz-options" id="modal-q-options"></div>
            <div class="quiz-feedback" id="modal-q-feedback"></div>
            <button class="close-modal" onclick="closeQuiz()">é—œé–‰</button>
        </div>
    </div>

<script>
    // --- å…¨åŸŸè®Šæ•¸èˆ‡è¨ˆåˆ†ç³»çµ± ---
    let currentExpId = 0;
    let totalScore = 0;
    const MAX_SCORE = 15; // 5é¡Œ * 3åˆ†

    function updateScore(points) {
        totalScore += points;
        const percentage = Math.min((totalScore / MAX_SCORE) * 100, 100);
        document.getElementById('energy-fill').style.width = percentage + '%';
        document.getElementById('energy-text').innerText = totalScore + ' åˆ†';
    }

    const quizData = {
        1: { // æ‘©æ“¦èµ·é›»
            q: "çµ²çµ¹æ‘©æ“¦ç»ç’ƒæ£’å¾Œï¼Œç‚ºä½•ç»ç’ƒæ£’å¸¶æ­£é›»ï¼Ÿ",
            options: [
                { text: "è³ªå­å¾ç»ç’ƒæ£’ç§»å‹•åˆ°çµ²çµ¹", correct: false },
                { text: "é›»å­å¾ç»ç’ƒæ£’ç§»å‹•åˆ°çµ²çµ¹", correct: true },
                { text: "é›»å­å¾çµ²çµ¹ç§»å‹•åˆ°ç»ç’ƒæ£’", correct: false },
                { text: "å› ç‚ºæ‘©æ“¦ç”¢ç”Ÿäº†æ–°çš„æ­£é›»è·", correct: false }
            ],
            reason: "æ­£è§£ï¼šé›»å­å¸¶è² é›»ä¸”åœ¨å¤–å±¤å®¹æ˜“ç§»å‹•ã€‚ç»ç’ƒæ£’å¤±å»é›»å­ï¼Œå› æ­¤å¸¶æ­£é›»ï¼›çµ²çµ¹å¾—åˆ°é›»å­å¸¶è² é›»ã€‚"
        },
        2: { // éœé›»æ„Ÿæ‡‰
            q: "ç•¶å¸¶è² é›»çš„å¡‘è† æ£’é è¿‘é‡‘å±¬çƒï¼ˆä¸æ¥è§¸ï¼‰æ™‚ï¼Œé‡‘å±¬çƒæ•´é«”çš„æ·¨é›»è·ç‚ºä½•ï¼Ÿ",
            options: [
                { text: "å¸¶æ­£é›»", correct: false },
                { text: "å¸¶è² é›»", correct: false },
                { text: "ä¿æŒé›»ä¸­æ€§ï¼ˆæ·¨é›»è·ç‚º0ï¼‰", correct: true },
                { text: "è¿‘ç«¯æ­£é›»ï¼Œé ç«¯è² é›»ï¼Œç¸½é›»é‡å¢åŠ ", correct: false }
            ],
            reason: "æ­£è§£ï¼šéœé›»æ„Ÿæ‡‰åªæ˜¯è®“å°é«”å…§çš„è‡ªç”±é›»å­é‡æ–°åˆ†ä½ˆï¼ˆé›»è·åˆ†é›¢ï¼‰ï¼Œä¸¦æ²’æœ‰é›»è·é€²å‡ºå°é«”ï¼Œæ•…æ•´é«”ä»ç‚ºé›»ä¸­æ€§ã€‚"
        },
        3: { // æ„Ÿæ‡‰èµ·é›»
            q: "åˆ©ç”¨ã€Œå¸¶è² é›»ã€çš„å¡‘è† æ£’é€²è¡Œæ„Ÿæ‡‰èµ·é›»ï¼Œæœ€å¾Œé‡‘å±¬çƒæœƒå¸¶ä»€éº¼é›»ï¼Ÿ",
            options: [
                { text: "å¸¶æ­£é›»", correct: true },
                { text: "å¸¶è² é›»", correct: false },
                { text: "é›»ä¸­æ€§", correct: false },
                { text: "ä¸ä¸€å®š", correct: false }
            ],
            reason: "æ­£è§£ï¼šè² é›»æ£’æ’æ–¥é›»å­ç¶“ç”±æ¥åœ°ç·šæµå…¥åœ°ä¸‹ï¼Œç§»é–‹æ¥åœ°ç·šèˆ‡æ£’å­å¾Œï¼Œé‡‘å±¬çƒç¼ºä¹é›»å­ï¼Œæ•…å¸¶æ­£é›»ã€‚"
        },
        4: { // æ¥è§¸èµ·é›»
            q: "å¸¶æ­£é›»çš„ç»ç’ƒæ£’æ¥è§¸ä¸å¸¶é›»çš„é‡‘å±¬çƒï¼Œæ¥è§¸å¾Œå…©è€…å¸¶é›»æƒ…å½¢ï¼Ÿ",
            options: [
                { text: "ç»ç’ƒæ£’æ­£é›»ï¼Œé‡‘å±¬çƒè² é›»", correct: false },
                { text: "å…©è€…éƒ½å¸¶æ­£é›»", correct: true },
                { text: "å…©è€…éƒ½è®Šæˆé›»ä¸­æ€§", correct: false },
                { text: "ç»ç’ƒæ£’è®Šæˆè² é›»", correct: false }
            ],
            reason: "æ­£è§£ï¼šæ¥è§¸èµ·é›»æœƒã€Œåˆ†äº«ã€é›»è·ã€‚ç»ç’ƒæ£’ç¼ºé›»å­(æ­£)ï¼Œæ¥è§¸æ™‚å¸èµ°é‡‘å±¬çƒéƒ¨åˆ†é›»å­ï¼Œå°è‡´å…©è€…éƒ½ç¼ºé›»å­ï¼Œçš†å¸¶æ­£é›»ã€‚"
        },
        5: { // é‡‘ç®”é©—é›»å™¨
            q: "å¸¶æ­£é›»çš„ç»ç’ƒæ£’ã€Œé è¿‘ã€é‡‘ç®”é©—é›»å™¨é‡‘å±¬ç›¤ï¼ˆä¸æ¥è§¸ï¼‰ï¼Œé‡‘ç®”æœƒå¦‚ä½•ï¼Ÿ",
            options: [
                { text: "é–‰åˆä¸å‹•", correct: false },
                { text: "å¼µé–‹ï¼Œå› ç‚ºé‡‘ç®”å¸¶æ­£é›»", correct: true },
                { text: "å¼µé–‹ï¼Œå› ç‚ºé‡‘ç®”å¸¶è² é›»", correct: false },
                { text: "å…ˆå¼µé–‹å†é–‰åˆ", correct: false }
            ],
            reason: "æ­£è§£ï¼šéœé›»æ„Ÿæ‡‰ã€‚æ­£é›»æ£’å¸å¼•é›»å­åˆ°é‡‘å±¬ç›¤(ä¸Šæ–¹è² )ï¼Œæ­£é›»è·è¢«æ’æ–¥åˆ°é‡‘ç®”(ä¸‹æ–¹æ­£)ã€‚é‡‘ç®”å› åŒæ€§ç›¸æ–¥è€Œå¼µé–‹ã€‚"
        }
    };

    function goHome() {
        document.getElementById('home-screen').style.display = 'flex';
        document.getElementById('bottom-nav').style.display = 'none';
        for(let i=1; i<=5; i++) {
            const w = document.getElementById(`exp${i}-wrapper`);
            if(w) w.classList.remove('active');
        }
        currentExpId = 0;
    }

    function switchExp(id) {
        currentExpId = id;
        document.getElementById('home-screen').style.display = 'none';
        document.getElementById('bottom-nav').style.display = 'flex';
        for(let i=1; i<=5; i++) {
            const wrapper = document.getElementById(`exp${i}-wrapper`);
            const navBtn = document.getElementById(`nav-btn-${i}`);
            if(wrapper) {
                if(i === id) wrapper.classList.add('active');
                else wrapper.classList.remove('active');
            }
            if(navBtn) {
                if(i === id) navBtn.classList.add('active');
                else navBtn.classList.remove('active');
            }
        }
    }

    let hasAnswered = {}; 

    function openQuiz(id) {
        const data = quizData[id];
        if(!data) return;
        document.getElementById('modal-q-text').innerText = data.q;
        const optDiv = document.getElementById('modal-q-options');
        optDiv.innerHTML = '';
        document.getElementById('modal-q-feedback').style.display = 'none';
        document.getElementById('quiz-modal').style.display = 'flex';

        data.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.innerText = opt.text;
            btn.onclick = function() {
                checkAnswer(btn, opt.correct, data.reason, id);
            };
            optDiv.appendChild(btn);
        });
    }

    function checkAnswer(btn, isCorrect, reason, id) {
        const feedback = document.getElementById('modal-q-feedback');
        feedback.style.display = 'block';
        feedback.innerHTML = reason;
        
        const btns = document.querySelectorAll('#modal-q-options button');
        btns.forEach(b => b.disabled = true);

        if(isCorrect) {
            btn.classList.add('correct');
            feedback.style.color = '#1e8449';
            feedback.innerHTML = "ğŸ‰ ç­”å°äº†ï¼ " + feedback.innerHTML;
            if(!hasAnswered[id]) {
                updateScore(3);
                hasAnswered[id] = true;
            }
        } else {
            btn.classList.add('wrong');
            feedback.style.color = '#c0392b';
            feedback.innerHTML = "âŒ ç­”éŒ¯äº†ã€‚ " + feedback.innerHTML;
        }
    }

    function closeQuiz() {
        document.getElementById('quiz-modal').style.display = 'none';
    }

    function roundRect(ctx, x, y, width, height, radius, fill, stroke) {
        if (typeof stroke === 'undefined') stroke = true;
        if (typeof radius === 'undefined') radius = 5;
        ctx.beginPath();
        ctx.moveTo(x + radius, y);
        ctx.lineTo(x + width - radius, y);
        ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
        ctx.lineTo(x + width, y + height - radius);
        ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
        ctx.lineTo(x + radius, y + height);
        ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
        ctx.lineTo(x, y + radius);
        ctx.quadraticCurveTo(x, y, x + radius, y);
        ctx.closePath();
        if (stroke) ctx.stroke();
        if (fill) ctx.fill();
    }

    function getPointerPos(e, canvas) {
        const rect = canvas.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;
        return {
            x: (clientX - rect.left) * scaleX,
            y: (clientY - rect.top) * scaleY
        };
    }

    function setupInteractions(canvas, onStart, onMove, onEnd) {
        canvas.addEventListener('mousedown', (e) => onStart(e, getPointerPos(e, canvas)));
        canvas.addEventListener('mousemove', (e) => onMove(e, getPointerPos(e, canvas)));
        window.addEventListener('mouseup', onEnd);
        canvas.addEventListener('touchstart', (e) => {
            if(e.cancelable) e.preventDefault();
            onStart(e, getPointerPos(e, canvas));
        }, {passive: false});
        canvas.addEventListener('touchmove', (e) => {
            if(e.cancelable) e.preventDefault();
            onMove(e, getPointerPos(e, canvas));
        }, {passive: false});
        window.addEventListener('touchend', onEnd);
    }

    // ==========================================
    // å¯¦é©— 1: æ‘©æ“¦èµ·é›»
    // ==========================================
    (function() {
        const canvas = document.getElementById('canvas-e1');
        const ctx = canvas.getContext('2d');
        let rod = {x: 250, y: 150, w: 50, h: 250, type: 'glass'};
        let cloth = {x: 450, y: 200, w: 120, h: 120};
        let electrons = []; 
        let dragging = null;
        let dragOff = {x:0, y:0};
        let frictionDistance = 0;
        let lastDragPos = {x:0, y:0};

        function initParticles() {
            electrons = [];
            for(let i=0; i<8; i++) {
                let py = rod.y + 30 + i*25;
                electrons.push({x: rod.x+15, y: py, charge: -1, owner: 'rod', fixed:false});
                electrons.push({x: rod.x+35, y: py, charge: 1, owner: 'rod', fixed: true});
            }
            for(let i=0; i<8; i++) {
                let rx = cloth.x + 20 + Math.random()*80;
                let ry = cloth.y + 20 + Math.random()*80;
                electrons.push({x: rx, y: ry, charge: -1, owner: 'cloth', fixed:false});
                electrons.push({x: rx+5, y: ry+5, charge: 1, owner: 'cloth', fixed: true});
            }
            updateProgress();
            frictionDistance = 0;
        }
        initParticles();

        function draw() {
            if(currentExpId !== 1) { requestAnimationFrame(draw); return; }
            ctx.clearRect(0,0,canvas.width, canvas.height);
            
            ctx.save();
            if(rod.type==='glass') ctx.fillStyle = 'rgba(200,230,255,0.9)';
            else ctx.fillStyle = '#7f8c8d';
            ctx.strokeStyle = '#555';
            roundRect(ctx, rod.x, rod.y, rod.w, rod.h, 10, true, true);
            ctx.restore();
            
            ctx.save();
            ctx.fillStyle = rod.type === 'glass' ? '#e91e63' : '#d35400';
            roundRect(ctx, cloth.x, cloth.y, cloth.w, cloth.h, 10, true, true);
            ctx.restore();

            let transferTrigger = false;
            if(checkOverlap(rod, cloth) && frictionDistance > 50) { 
                transferTrigger = true;
                frictionDistance = 0; 
            }

            electrons.forEach(p => {
                let px = p.x; let py = p.y;
                if(p.owner === 'rod') {
                    let relX = p.x - (250); 
                    let relY = p.y - (150);
                    px = rod.x + relX; py = rod.y + relY;
                } else {
                    let relX = p.x - (450);
                    let relY = p.y - (200);
                    px = cloth.x + relX; py = cloth.y + relY;
                }
                
                if(transferTrigger && !p.fixed && Math.random()>0.7) {
                    if(rod.type==='glass' && p.owner==='rod' && p.charge===-1) {
                         p.owner = 'cloth';
                         p.x = 450 + 20 + Math.random()*80; 
                         p.y = 200 + 20 + Math.random()*80;
                         updateProgress();
                         transferTrigger = false; 
                    } else if (rod.type==='plastic' && p.owner==='cloth' && p.charge===-1) {
                         p.owner = 'rod';
                         p.x = 250 + 10 + Math.random()*30;
                         p.y = 150 + Math.random()*200;
                         updateProgress();
                         transferTrigger = false;
                    }
                }

                ctx.beginPath(); ctx.arc(px, py, 6, 0, Math.PI*2);
                ctx.fillStyle = p.charge > 0 ? '#e74c3c' : '#3498db';
                ctx.fill();
                ctx.fillStyle = 'white'; ctx.font='10px Arial'; ctx.textAlign='center';
                ctx.fillText(p.charge>0?'+':'-', px, py+3);
            });

            requestAnimationFrame(draw);
        }
        
        function checkOverlap(r, c) {
            return (r.x < c.x + c.w && r.x + r.w > c.x && r.y < c.y + c.h && r.y + r.h > c.y);
        }

        function updateProgress() {
            let count = 0;
            if(rod.type === 'glass') {
                let current = electrons.filter(p=>p.owner==='rod' && p.charge===-1).length;
                count = 8 - current; 
            } else {
                let current = electrons.filter(p=>p.owner==='rod' && p.charge===-1).length;
                count = current - 8;
            }
            if(count < 0) count = 0;
            if(count > 10) count = 10;
            document.getElementById('progress-display-e1').innerText = count + " / 8";
        }

        setupInteractions(canvas, 
            (e, pos) => {
                if(currentExpId!==1) return;
                if(pos.x>cloth.x && pos.x<cloth.x+cloth.w && pos.y>cloth.y && pos.y<cloth.y+cloth.h) {
                    dragging = cloth; dragOff = {x:pos.x-cloth.x, y:pos.y-cloth.y};
                    lastDragPos = {x: pos.x, y: pos.y};
                }
            },
            (e, pos) => {
                if(!dragging || currentExpId!==1) return;
                let dx = pos.x - lastDragPos.x;
                let dy = pos.y - lastDragPos.y;
                let dist = Math.sqrt(dx*dx + dy*dy);
                
                if(checkOverlap(rod, cloth)) {
                    frictionDistance += dist;
                }

                dragging.x = pos.x - dragOff.x;
                dragging.y = pos.y - dragOff.y;
                lastDragPos = {x: pos.x, y: pos.y};
            },
            () => { dragging = null; frictionDistance = 0; }
        );

        document.getElementById('btn-glass-e1').onclick = () => { rod.type='glass'; initParticles(); document.getElementById('btn-glass-e1').classList.add('active'); document.getElementById('btn-plastic-e1').classList.remove('active'); };
        document.getElementById('btn-plastic-e1').onclick = () => { rod.type='plastic'; initParticles(); document.getElementById('btn-plastic-e1').classList.add('active'); document.getElementById('btn-glass-e1').classList.remove('active'); };
        document.getElementById('btn-reset-e1').onclick = () => { cloth.x=450; cloth.y=200; initParticles(); };

        requestAnimationFrame(draw);
    })();

    // ==========================================
    // å¯¦é©— 2: éœé›»æ„Ÿæ‡‰
    // ==========================================
    (function() {
        const canvas = document.getElementById('canvas-e2');
        const ctx = canvas.getContext('2d');
        let rod = {x: 50, y: 200, w: 200, h: 40, type: 'glass'}; 
        let particles = [];
        let dragging = null;
        let dragOff = {x:0, y:0};

        function init() {
            rod.x = 50;
            particles = [];
            for(let y=-70; y<=70; y+=35) {
                for(let x=-70; x<=70; x+=35) {
                    if(x*x+y*y < 75*75) {
                        particles.push({x:x, y:y, q:1, fixed:true}); 
                        particles.push({x:x, y:y, q:-1, fixed:false, dx:0, dy:0}); 
                    }
                }
            }
        }
        init();

        function draw() {
            if(currentExpId!==2) { requestAnimationFrame(draw); return; }
            ctx.clearRect(0,0,canvas.width, canvas.height);

            let sphereX = 550, sphereY = 220, sphereR = 90;
            
            let rodTipX = rod.x + rod.w; 
            let dist = sphereX - rodTipX - sphereR;
            let effect = 0;
            if(dist < 200) effect = (200 - dist)/200;
            if(effect < 0) effect = 0; if(effect > 1) effect = 1;

            let nearNet = 0; 
            let farNet = 0;  
            let totalPos = 0;
            let totalNeg = 0;

            particles.forEach(p => {
                let currentX = sphereX + p.x;
                if(!p.fixed) {
                    let dir = (rod.type==='glass') ? -1 : 1; 
                    let shift = effect * 50 * dir;
                    currentX += shift;
                    let dx = currentX - sphereX; let dy = p.y; 
                    let d = Math.sqrt(dx*dx + dy*dy);
                    if(d > sphereR-10) currentX = sphereX + (dx/d)*(sphereR-10);
                }
                
                if(currentX < sphereX) nearNet += p.q;
                else farNet += p.q;

                if(p.q > 0) totalPos++;
                else totalNeg++;
            });

            let nearSign = nearNet > 0 ? "+" : "";
            let farSign = farNet > 0 ? "+" : "";
            let nearText = `è¿‘ç«¯æ·¨é›»é‡ï¼š${nearNet === 0 ? "0" : nearSign + nearNet + "e"}`;
            let farText = `é ç«¯æ·¨é›»é‡ï¼š${farNet === 0 ? "0" : farSign + farNet + "e"}`;

            let leftBg = 'rgba(236, 240, 241, 0.2)';
            let rightBg = 'rgba(236, 240, 241, 0.2)';
            let nearColor = "#7f8c8d";
            let farColor = "#7f8c8d";

            if(Math.abs(nearNet) > 0) {
                if(nearNet < 0) { 
                    leftBg = 'rgba(52, 152, 219, 0.2)'; nearColor = "#2980b9";
                    rightBg = 'rgba(231, 76, 60, 0.2)'; farColor = "#c0392b";
                } else { 
                    leftBg = 'rgba(231, 76, 60, 0.2)'; nearColor = "#c0392b";
                    rightBg = 'rgba(52, 152, 219, 0.2)'; farColor = "#2980b9";
                }
            }

            let boxW = 180; let boxH = 280;
            ctx.fillStyle = leftBg; 
            ctx.fillRect(sphereX - boxW, sphereY - boxH/2, boxW, boxH);
            ctx.fillStyle = rightBg; 
            ctx.fillRect(sphereX, sphereY - boxH/2, boxW, boxH);
            
            ctx.beginPath();
            ctx.moveTo(sphereX, sphereY - boxH/2);
            ctx.lineTo(sphereX, sphereY + boxH/2);
            ctx.setLineDash([5, 5]);
            ctx.strokeStyle = "#bdc3c7";
            ctx.stroke();
            ctx.setLineDash([]);

            ctx.font = "bold 18px Microsoft JhengHei";
            ctx.textAlign = "center";
            
            ctx.fillStyle = nearColor;
            ctx.fillText(nearText, sphereX - boxW/2, sphereY - boxH/2 - 10);
            
            ctx.fillStyle = farColor;
            ctx.fillText(farText, sphereX + boxW/2, sphereY - boxH/2 - 10);

            ctx.fillStyle = "#555";
            ctx.font = "16px Microsoft JhengHei";
            let totalQ = totalPos - totalNeg;
            let totalText = `æ­£é›»è·: +${totalPos}e   è² é›»è·: -${totalNeg}e   å°é«”æ·¨é›»é‡: ${totalQ} (å®ˆæ†)`;
            ctx.fillText(totalText, sphereX, sphereY + boxH/2 + 30);

            ctx.beginPath(); ctx.arc(sphereX, sphereY, sphereR, 0, Math.PI*2);
            let grad = ctx.createRadialGradient(sphereX-30, sphereY-30, 10, sphereX, sphereY, sphereR);
            grad.addColorStop(0, '#f1c40f'); grad.addColorStop(1, '#f39c12');
            ctx.fillStyle = grad; ctx.fill(); ctx.stroke();
            
            particles.forEach(p => {
                let tx = sphereX + p.x; 
                let ty = sphereY + p.y;
                
                if(!p.fixed) {
                    let dir = (rod.type==='glass') ? -1 : 1; 
                    let shift = effect * 50 * dir; 
                    tx += shift;
                    let dx = tx - sphereX; let dy = ty - sphereY;
                    let d = Math.sqrt(dx*dx + dy*dy);
                    if(d > sphereR-10) {
                        tx = sphereX + (dx/d)*(sphereR-10);
                        ty = sphereY + (dy/d)*(sphereR-10);
                    }
                }

                ctx.beginPath(); ctx.arc(tx, ty, 6, 0, Math.PI*2);
                ctx.fillStyle = p.q>0 ? '#e74c3c' : '#3498db';
                ctx.fill();
                ctx.fillStyle = 'white'; ctx.font='10px Arial'; ctx.textAlign='center';
                ctx.fillText(p.q>0?'+':'-', tx, ty+3);
            });

            ctx.save();
            ctx.fillStyle = rod.type==='glass' ? 'rgba(200,230,255,0.9)' : '#7f8c8d';
            roundRect(ctx, rod.x, rod.y, rod.w, rod.h, 15, true, true);
            let chargeSym = rod.type==='glass' ? '+' : '-';
            ctx.fillStyle = '#333'; ctx.font='20px Arial';
            ctx.fillText(chargeSym.repeat(6), rod.x+70, rod.y+25);
            ctx.restore();

            requestAnimationFrame(draw);
        }

        setupInteractions(canvas, 
            (e, pos) => {
                if(currentExpId!==2) return;
                if(pos.x>rod.x && pos.x<rod.x+rod.w && pos.y>rod.y && pos.y<rod.y+rod.h) {
                    dragging = rod; dragOff = {x:pos.x-rod.x, y:pos.y-rod.y};
                }
            },
            (e, pos) => {
                if(!dragging || currentExpId!==2) return;
                dragging.x = pos.x - dragOff.x;
                dragging.y = pos.y - dragOff.y;
            },
            () => dragging = null
        );
        
        document.getElementById('btn-glass-e2').onclick = () => { rod.type='glass'; document.getElementById('btn-glass-e2').classList.add('active'); document.getElementById('btn-plastic-e2').classList.remove('active'); };
        document.getElementById('btn-plastic-e2').onclick = () => { rod.type='plastic'; document.getElementById('btn-plastic-e2').classList.add('active'); document.getElementById('btn-glass-e2').classList.remove('active'); };
        document.getElementById('btn-reset-e2').onclick = () => { rod.x=50; };

        requestAnimationFrame(draw);
    })();

    // ==========================================
    // å¯¦é©— 3: æ„Ÿæ‡‰èµ·é›» (è‡ªç”±æ‹–æ›³ç‰ˆ)
    // ==========================================
    (function() {
        const canvas = document.getElementById('canvas-e3');
        const ctx = canvas.getContext('2d');
        
        // ç‰©ä»¶å®šç¾©
        let rod = {x: 50, y: 200, w: 200, h: 40, type: 'glass'};
        let sphere = {x: 600, y: 220, r: 90};
        let person = {x: 800, y: 300, w: 60, h: 100, isTouching: false}; // Person/Hand position
        
        let particles = [];
        let draggingObj = null;
        let dragOff = {x:0, y:0};
        
        // ç‰©ç†åƒæ•¸
        let groundingTimer = 0;

        function init() {
            rod.x = 50;
            person.x = 800; // Reset positions
            person.y = 300;
            particles = [];
            // åˆå§‹åŒ–ç²’å­: 12 å°
            for(let i=0; i<12; i++) {
                // è³ªå­ (å›ºå®š) - å‡å‹»æ’åˆ—æ–¹ä¾¿çœ‹
                let angle = (Math.PI * 2 * i) / 12;
                let r = sphere.r * 0.6;
                particles.push({
                    x: sphere.x + Math.cos(angle)*r, 
                    y: sphere.y + Math.sin(angle)*r, 
                    q: 1, fixed: true
                });
                // é›»å­ (è‡ªç”±) - åˆå§‹ä½ç½®èˆ‡è³ªå­ç›¸åŒ
                particles.push({
                    x: sphere.x + Math.cos(angle)*r, 
                    y: sphere.y + Math.sin(angle)*r, 
                    q: -1, fixed: false
                }); 
            }
            updateStatusText();
        }
        init();

        function updateStatusText() {
            // Update handled in draw loop for real-time feedback
        }

        function draw() {
            if(currentExpId!==3) { requestAnimationFrame(draw); return; }
            ctx.clearRect(0,0,canvas.width, canvas.height);

            // 1. æª¢æ¸¬ç‹€æ…‹
            let rodTipX = rod.x + rod.w;
            let distToSphere = (sphere.x - sphere.r) - rodTipX;
            let isNear = distToSphere < 200 && distToSphere > 0;
            
            // é™åˆ¶æ£’å­ä¸èƒ½ç¢°åˆ°çƒ (ä¿æŒæœ€å°è·é›¢ 10px)
            if(rod.x + rod.w > sphere.x - sphere.r - 10) {
                rod.x = sphere.x - sphere.r - 10 - rod.w;
            }

            // æª¢æ¸¬äººæ˜¯å¦æ¥åœ°
            // å‡è¨­äººçš„æ‰‹åœ¨ person.x å·¦å´ (person drawing centered roughly)
            // person.x is center of head in drawPerson, let's allow some range
            let handX = person.x - 50; // Hand reaches out to left
            let sphereRight = sphere.x + sphere.r;
            
            // Simple proximity check for "touching" the right side of sphere
            // Person body is at person.x, sphere right edge is sphereRight
            // If person is close enough (e.g. x < sphereRight + 100)
            person.isTouching = (person.x - sphereRight < 100 && person.x > sphereRight);

            // 2. ç‰©ç†è¨ˆç®—
            // æ„Ÿæ‡‰å¼·åº¦ (0 ~ 1)
            let induction = 0;
            if(isNear) {
                induction = 1 - (distToSphere / 200);
            }
            
            // æ£’å­é›»è·ç¬¦è™Ÿ
            let rodSign = (rod.type === 'glass') ? 1 : -1;

            if(person.isTouching) {
                groundingTimer++;
                if(groundingTimer > 5) { // é™ä½æµå‹•é€Ÿåº¦
                    groundingTimer = 0;
                    let currentElectrons = particles.filter(p => !p.fixed).length;
                    let targetElectrons = 12; 
                    
                    // Induction effect on grounding equilibrium
                    if(rodSign === 1) { // æ£’æ­£ -> å¸é›»å­ -> çƒå¸¶è²  (éœ€æ›´å¤šé›»å­)
                        targetElectrons = 12 + Math.floor(induction * 8); 
                    } else { // æ£’è²  -> æ–¥é›»å­ -> çƒå¸¶æ­£ (éœ€æ›´å°‘é›»å­)
                        targetElectrons = 12 - Math.floor(induction * 8);
                    }
                    
                    if(currentElectrons < targetElectrons) {
                        // å¾åœ°æµå…¥é›»å­
                        particles.push({
                            x: sphereRight, 
                            y: sphere.y + (Math.random()-0.5)*20, 
                            q: -1, fixed: false
                        });
                    } else if(currentElectrons > targetElectrons) {
                        // æµå‡ºé›»å­ (ç§»é™¤æœ€å³é‚Šçš„é›»å­)
                        let mobiles = particles.filter(p => !p.fixed);
                        mobiles.sort((a,b) => b.x - a.x);
                        if(mobiles.length > 0) {
                            let p = mobiles[0];
                            let idx = particles.indexOf(p);
                            if(idx > -1) particles.splice(idx, 1);
                        }
                    }
                }
            }

            // 3. ç²’å­ç§»å‹•
            particles.forEach(p => {
                if(p.fixed) return;
                
                // å—æ£’å­å½±éŸ¿
                let forceX = -rodSign * induction * 60;
                
                // ç°¡å–®æ¨¡æ“¬ï¼šç›®æ¨™ä½ç½® = åŸå§‹ä½ç½® + æ„Ÿæ‡‰åç§»
                // ç‚ºäº†ä¸è®“æ‰€æœ‰é›»å­æ“ åœ¨ä¸€èµ·ï¼Œä¿ç•™å…¶ç›¸å°åˆ†ä½ˆç‰¹å¾µ
                // é€™è£¡æˆ‘å€‘è®“å®ƒåœ¨çƒå…§ç§»å‹•
                
                p.x += (forceX * 0.05); 
                
                // éš¨æ©Ÿç†±é‹å‹• (æ“´æ•£)
                p.x += (Math.random()-0.5)*2;
                p.y += (Math.random()-0.5)*2;

                // é‚Šç•Œé™åˆ¶ (çƒé«”)
                let dx = p.x - sphere.x;
                let dy = p.y - sphere.y;
                let d2 = Math.sqrt(dx*dx + dy*dy);
                if(d2 > sphere.r - 8) {
                    let scale = (sphere.r - 8) / d2;
                    p.x = sphere.x + dx * scale;
                    p.y = sphere.y + dy * scale;
                }
            });

            // 4. ç¹ªåœ–
            
            // æ£’å­
            ctx.save();
            let gradRod = ctx.createLinearGradient(rod.x, 0, rod.x+rod.w, 0);
            if(rod.type === 'glass') { 
                gradRod.addColorStop(0, '#dbeafe'); gradRod.addColorStop(1, '#93c5fd'); 
                ctx.fillStyle = gradRod; ctx.strokeStyle = '#3b82f6';
            } else { 
                gradRod.addColorStop(0, '#7f8c8d'); gradRod.addColorStop(1, '#34495e'); 
                ctx.fillStyle = gradRod; ctx.strokeStyle = '#2c3e50';
            }
            roundRect(ctx, rod.x, rod.y, rod.w, rod.h, 10, true, true);
            ctx.fillStyle = 'white'; ctx.font='20px Arial'; ctx.textAlign='center';
            ctx.fillText(rod.type==='glass'?"++++++":"------", rod.x+rod.w/2, rod.y+27);
            ctx.restore();

            // çƒ
            ctx.beginPath(); ctx.arc(sphere.x, sphere.y, sphere.r, 0, Math.PI*2);
            let gradSphere = ctx.createRadialGradient(sphere.x-20, sphere.y-20, 10, sphere.x, sphere.y, sphere.r);
            gradSphere.addColorStop(0, '#f1c40f'); gradSphere.addColorStop(1, '#d35400');
            ctx.fillStyle = gradSphere; ctx.fill(); ctx.stroke();

            // ç²’å­
            particles.forEach(p => {
                ctx.beginPath(); ctx.arc(p.x, p.y, 6, 0, Math.PI*2);
                if(p.fixed) {
                    ctx.fillStyle='#c0392b'; ctx.fill();
                    ctx.fillStyle='white'; ctx.font='10px Arial'; ctx.fillText('+', p.x, p.y+3);
                } else {
                    ctx.fillStyle='#2980b9'; ctx.fill();
                    ctx.fillStyle='white'; ctx.font='10px Arial'; ctx.fillText('-', p.x, p.y+3);
                }
            });

            // äºº (æ‹–æ›³ç‰©ä»¶)
            drawPerson(ctx, person.x, person.y, person.isTouching);

            // æ·¨é›»è·è¨ˆç®—èˆ‡é¡¯ç¤º
            let pCount = particles.filter(p=>p.fixed).length;
            let eCount = particles.filter(p=>!p.fixed).length;
            let net = pCount - eCount;
            let statusText = "ç‹€æ…‹ï¼š";
            
            if(person.isTouching) statusText += "æ¥åœ°ä¸­";
            else if(isNear) statusText += "æ„Ÿæ‡‰ä¸­";
            else statusText += "é–’ç½®";

            document.getElementById('net-charge-display-e3').innerText = (net > 0 ? "+" + net : net);
            document.getElementById('guide-status-e3').innerText = statusText; 

            requestAnimationFrame(draw);
        }

        function drawPerson(ctx, x, y, isTouching) {
            ctx.save();
            ctx.translate(x, y); // x,y is center of head approx
            
            // èº«é«”é¡è‰²
            ctx.strokeStyle = '#34495e';
            ctx.lineWidth = 4;
            
            // é ­
            ctx.beginPath(); ctx.arc(0, -50, 20, 0, Math.PI*2); 
            ctx.fillStyle = '#f1c40f'; ctx.fill(); ctx.stroke();
            // ç¬‘è‡‰
            ctx.beginPath(); ctx.arc(-7, -55, 2, 0, Math.PI*2); ctx.fillStyle='black'; ctx.fill();
            ctx.beginPath(); ctx.arc(7, -55, 2, 0, Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc(0, -45, 10, 0, Math.PI, false); ctx.stroke();

            // è»€å¹¹
            ctx.beginPath(); ctx.moveTo(0, -30); ctx.lineTo(0, 40); ctx.stroke();
            
            // è…³
            ctx.beginPath(); ctx.moveTo(0, 40); ctx.lineTo(-20, 80); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(0, 40); ctx.lineTo(20, 80); ctx.stroke();

            // æ‰‹ (ä¼¸æ‰‹å»æ‘¸)
            ctx.beginPath(); ctx.moveTo(0, -10); 
            if(isTouching) {
                ctx.lineTo(-50, -20); // ä¼¸å‘å·¦é‚Š (çƒçš„æ–¹å‘)
                // æ¥åœ°ç¬¦è™Ÿ
                ctx.save();
                ctx.translate(-50, -20); // Move to hand tip
                ctx.strokeStyle = '#27ae60';
                ctx.beginPath(); ctx.moveTo(0, 0); ctx.lineTo(0, 30); // Wire down
                // Ground lines
                ctx.moveTo(-15, 30); ctx.lineTo(15, 30);
                ctx.moveTo(-10, 35); ctx.lineTo(10, 35);
                ctx.moveTo(-5, 40); ctx.lineTo(5, 40);
                ctx.stroke();
                ctx.fillStyle = '#27ae60'; ctx.font='14px Arial'; ctx.textAlign='center';
                ctx.fillText("æ¥åœ°", 0, 55);
                ctx.restore();
            } else {
                ctx.lineTo(-20, 20); // ä¸‹å‚
                ctx.fillStyle = '#e67e22'; ctx.font='14px Arial'; ctx.textAlign='center';
                ctx.fillText("æ‹–æ›³æˆ‘", 0, -80);
            }
            ctx.strokeStyle = '#34495e'; // reset
            ctx.stroke();

            ctx.restore();
        }

        // äº’å‹•äº‹ä»¶ Setup (åŒå…¶ä»–é—œå¡)
        setupInteractions(canvas, 
            (e, pos) => {
                if(currentExpId!==3) return;
                // Check Rod
                if(pos.x>rod.x && pos.x<rod.x+rod.w && pos.y>rod.y && pos.y<rod.y+rod.h) {
                    draggingObj = rod; dragOff = {x:pos.x-rod.x, y:pos.y-rod.y};
                }
                // Check Person (Center is x,y. Head radius 20, body height ~100)
                else if(Math.abs(pos.x - person.x) < 40 && Math.abs(pos.y - person.y) < 100) {
                    draggingObj = person; dragOff = {x:pos.x-person.x, y:pos.y-person.y};
                }
            },
            (e, pos) => {
                if(!draggingObj || currentExpId!==3) return;
                draggingObj.x = pos.x - dragOff.x;
                draggingObj.y = pos.y - dragOff.y;
            },
            () => draggingObj = null
        );
        
        // Buttons
        document.getElementById('btn-glass-e3').onclick = () => { rod.type='glass'; init(); document.getElementById('btn-glass-e3').classList.add('active'); document.getElementById('btn-plastic-e3').classList.remove('active'); };
        document.getElementById('btn-plastic-e3').onclick = () => { rod.type='plastic'; init(); document.getElementById('btn-plastic-e3').classList.add('active'); document.getElementById('btn-glass-e3').classList.remove('active'); };
        document.getElementById('btn-reset-e3').onclick = init;

        requestAnimationFrame(draw);
    })();

    // ==========================================
    // å¯¦é©— 4: æ¥è§¸èµ·é›»
    // ==========================================
    (function() {
        const canvas = document.getElementById('canvas-e4');
        const ctx = canvas.getContext('2d');
        let rod = {x: 50, y: 150, w: 200, h: 40, type: 'plastic'};
        let particles = [];
        let dragging = null;
        let dragOff = {x:0, y:0};

        function init() {
            rod.x = 50;
            particles = [];
            let qType = (rod.type==='plastic') ? -1 : 1;
            for(let i=0; i<10; i++) {
                particles.push({x: rod.x+20+i*18, y: rod.y+20, q:qType, owner:'rod'});
            }
        }
        init();

        function draw() {
            if(currentExpId!==4) { requestAnimationFrame(draw); return; }
            ctx.clearRect(0,0,canvas.width, canvas.height);
            let sphereX = 550, sphereY = 170, sphereR = 90;

            let rodTip = rod.x + rod.w;
            if(rodTip > sphereX - sphereR && rod.x < sphereX + sphereR && 
               rod.y + rod.h > sphereY - sphereR && rod.y < sphereY + sphereR) {
                   let rodPs = particles.filter(p=>p.owner==='rod');
                   let transferCount = 0;
                   rodPs.forEach(p => {
                       if(p.owner==='rod' && Math.random()>0.95 && transferCount < 1) {
                           p.owner = 'sphere';
                           transferCount++;
                       }
                   });
            }

            ctx.beginPath(); ctx.arc(sphereX, sphereY, sphereR, 0, Math.PI*2);
            ctx.fillStyle = '#f39c12'; ctx.fill(); ctx.stroke();
            
            particles.forEach(p => {
                if(p.owner === 'rod') {
                    let offset = (particles.indexOf(p) % 10) * 18;
                    p.x = rod.x + 20 + offset; 
                    p.y = rod.y + 20;
                } else {
                    let spherePs = particles.filter(pt=>pt.owner==='sphere');
                    let idx = spherePs.indexOf(p);
                    let ang = (Math.PI*2 * idx) / spherePs.length;
                    p.x = sphereX + Math.cos(ang)*(sphereR-10);
                    p.y = sphereY + Math.sin(ang)*(sphereR-10);
                }
                
                ctx.beginPath(); ctx.arc(p.x, p.y, 6, 0, Math.PI*2);
                ctx.fillStyle = p.q>0 ? '#e74c3c' : '#3498db';
                ctx.fill();
                ctx.fillStyle = 'white'; ctx.fillText(p.q>0?'+':'-', p.x, p.y+3);
            });

            ctx.fillStyle = rod.type==='glass' ? '#85c1e9' : '#7f8c8d';
            roundRect(ctx, rod.x, rod.y, rod.w, rod.h, 10, true, true);

            requestAnimationFrame(draw);
        }

        setupInteractions(canvas, 
            (e, pos) => {
                if(currentExpId!==4) return;
                if(pos.x>rod.x && pos.x<rod.x+rod.w && pos.y>rod.y && pos.y<rod.y+rod.h) {
                    dragging = rod; dragOff = {x:pos.x-rod.x, y:pos.y-rod.y};
                }
            },
            (e, pos) => {
                if(!dragging || currentExpId!==4) return;
                dragging.x = pos.x - dragOff.x;
                dragging.y = pos.y - dragOff.y;
            },
            () => dragging = null
        );

        document.getElementById('btn-plastic-e4').onclick = () => { rod.type='plastic'; init(); document.getElementById('btn-plastic-e4').classList.add('active'); document.getElementById('btn-glass-e4').classList.remove('active'); };
        document.getElementById('btn-glass-e4').onclick = () => { rod.type='glass'; init(); document.getElementById('btn-glass-e4').classList.add('active'); document.getElementById('btn-plastic-e4').classList.remove('active'); };
        document.getElementById('btn-reset-e4').onclick = init;

        requestAnimationFrame(draw);
    })();

    // ==========================================
    // å¯¦é©— 5: é‡‘ç®”é©—é›»å™¨
    // ==========================================
    (function() {
        const canvas = document.getElementById('canvas-e5');
        const ctx = canvas.getContext('2d');
        let rod = {x: 50, y: 150, w: 200, h: 40, type: 'glass', charge: 1}; 
        let dragging = null;
        let dragOff = {x:0, y:0};
        let isGrounded = false;
        let initialChargeState = 0; 

        let eParticles = []; 

        function initEParticles() {
            eParticles = [];
            const headX = 400, headY = 180, headR = 40;
            const stemX = 395, stemY = 180;
            
            for(let i=0; i<6; i++) {
                let ang = Math.random() * Math.PI * 2;
                let r = Math.random() * (headR - 5);
                eParticles.push({
                    x: headX + Math.cos(ang)*r, 
                    y: headY + Math.sin(ang)*r,
                    q: 1, fixed: true, region: 'head'
                });
            }
            for(let i=0; i<8; i++) {
                let py = stemY + 20 + i*12; 
                eParticles.push({
                    x: stemX + 5 + (Math.random()-0.5)*4,
                    y: py,
                    q: 1, fixed: true, region: 'stem'
                });
            }

            let electronCount = 14; 
            if(initialChargeState === 1) electronCount = 8; 
            if(initialChargeState === -1) electronCount = 20; 

            for(let i=0; i<electronCount; i++) {
                let y = 150 + Math.random() * 150;
                let x = 400 + (Math.random()-0.5)*20;
                if(y < 180 + headR) { 
                     let ang = Math.random() * Math.PI * 2;
                     let r = Math.random() * (headR - 5);
                     x = headX + Math.cos(ang)*r;
                     y = headY + Math.sin(ang)*r;
                } else { 
                     x = stemX + 5 + (Math.random()-0.5)*6;
                }
                
                eParticles.push({
                    x: x, y: y, q: -1, fixed: false, 
                    vx: 0, vy: 0
                });
            }
        }
        initEParticles();

        function draw() {
            if(currentExpId !== 5) { requestAnimationFrame(draw); return; }
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const headX = 400, headY = 180;
            const rodCX = rod.x + rod.w/2;
            const rodCY = rod.y + rod.h/2;
            const dist = Math.sqrt((rodCX-headX)**2 + (rodCY-headY)**2);
            let inductionForceY = 0;

            if(dist < 400) { 
                let strength = (400 - dist) / 400; 
                let forceDir = (rod.charge > 0) ? -1 : 1; 
                inductionForceY = strength * forceDir * 8.0; 
            }

            if(dist < 80) {
                if(Math.random() > 0.85) {
                    if(rod.charge > 0) { 
                        let mobiles = eParticles.filter(p => !p.fixed && p.q === -1);
                        if(mobiles.length > 4) { 
                            let idx = Math.floor(Math.random()*mobiles.length);
                            let realIdx = eParticles.indexOf(mobiles[idx]);
                            if(realIdx > -1) eParticles.splice(realIdx, 1);
                        }
                    } else { 
                        eParticles.push({
                            x: headX + (Math.random()-0.5)*10, 
                            y: headY + (Math.random()-0.5)*10, 
                            q: -1, fixed: false, vx: 0, vy: 0
                        });
                    }
                }
            }

            if(isGrounded) {
                let bottomElectrons = eParticles.filter(p => !p.fixed && p.y > 250).length;
                let bottomProtons = eParticles.filter(p => p.fixed && p.y > 250).length;
                
                if(Math.random() > 0.7) {
                    if(inductionForceY < 0) { 
                         if(bottomElectrons < bottomProtons + 4) { 
                             eParticles.push({x: 400, y: 320, q:-1, fixed:false, vx:0, vy:-5});
                         }
                    } else if (inductionForceY > 0) {
                         let downEs = eParticles.filter(p => !p.fixed && p.y > 250);
                         if(downEs.length > bottomProtons) {
                             let p = downEs[0];
                             let idx = eParticles.indexOf(p);
                             if(idx > -1) eParticles.splice(idx, 1);
                         }
                    } else {
                        let totalE = eParticles.filter(p=>!p.fixed).length;
                        let totalP = eParticles.filter(p=>p.fixed).length;
                        if(totalE < totalP) eParticles.push({x:400,y:300,q:-1,fixed:false});
                        if(totalE > totalP) {
                            let idx = eParticles.findIndex(p=>!p.fixed);
                            if(idx>-1) eParticles.splice(idx,1);
                        }
                    }
                }
            }

            eParticles.forEach(p => {
                if(p.fixed) return;
                
                p.vy = inductionForceY;
                
                p.vx = (Math.random()-0.5) * 3;
                p.vy += (Math.random()-0.5) * 3;

                let nextX = p.x + p.vx;
                let nextY = p.y + p.vy;

                let inHead = Math.sqrt((nextX-400)**2 + (nextY-180)**2) < 38;
                let inStem = (nextX > 390 && nextX < 410 && nextY >= 180 && nextY < 320);
                
                if(inHead || inStem) {
                    p.x = nextX;
                    p.y = nextY;
                } else {
                    if(nextY < 145) p.y = 150;
                    if(nextY > 315) p.y = 310;
                    if(nextX < 365) p.x = 370;
                    if(nextX > 435) p.x = 430;
                }
            });

            let bE = eParticles.filter(p => !p.fixed && p.y > 240).length;
            let bP = eParticles.filter(p => p.fixed && p.y > 240).length;
            let netBottom = Math.abs(bE - bP);
            let targetAngle = netBottom * 15; 
            if(targetAngle > 90) targetAngle = 90;
            
            let tE = eParticles.filter(p => !p.fixed && p.y <= 240).length;
            let tP = eParticles.filter(p => p.fixed && p.y <= 240).length;
            document.getElementById('top-charge-e5').innerText = (tP - tE);
            document.getElementById('bottom-charge-e5').innerText = (bP - bE);

            let currentAngleDisp = parseFloat(document.getElementById('leaf-angle-e5').getAttribute('data-val') || 0);
            let newAngle = currentAngleDisp + (targetAngle - currentAngleDisp) * 0.15; 
            document.getElementById('leaf-angle-e5').innerText = Math.round(newAngle) + "åº¦";
            document.getElementById('leaf-angle-e5').setAttribute('data-val', newAngle);

            ctx.strokeStyle = '#7f8c8d'; ctx.lineWidth = 2;
            ctx.strokeRect(350, 200, 100, 150);
            ctx.fillStyle = 'rgba(255,255,255,0.5)';
            ctx.fillRect(350, 200, 100, 150);
            
            ctx.fillStyle = '#95a5a6';
            ctx.fillRect(395, 180, 10, 140); 
            
            ctx.beginPath(); ctx.arc(400, 180, 40, 0, Math.PI*2);
            ctx.fillStyle = '#bdc3c7'; ctx.fill(); ctx.stroke();

            let lx = 400; let ly = 320;
            let angRad = newAngle * Math.PI / 180;
            ctx.fillStyle = '#f1c40f'; 
            ctx.save(); ctx.translate(lx, ly); ctx.rotate(-angRad); ctx.fillRect(-2, 0, 4, 60); ctx.restore();
            ctx.save(); ctx.translate(lx, ly); ctx.rotate(angRad); ctx.fillRect(-2, 0, 4, 60); ctx.restore();

            eParticles.forEach(p => {
                ctx.beginPath();
                ctx.arc(p.x, p.y, 6, 0, Math.PI*2); 
                if(p.q > 0) {
                    ctx.fillStyle = '#e74c3c'; 
                } else {
                    ctx.fillStyle = '#3498db'; 
                }
                ctx.fill();
                ctx.fillStyle = 'white'; ctx.font='10px Arial'; ctx.textAlign='center'; 
                ctx.fillText(p.q>0?'+':'-', p.x, p.y+4);
            });

            ctx.save();
            let grad = ctx.createLinearGradient(rod.x, 0, rod.x+rod.w, 0);
            if(rod.type === 'glass') { 
                grad.addColorStop(0, '#dbeafe'); grad.addColorStop(1, '#93c5fd'); 
                ctx.fillStyle = grad; ctx.strokeStyle = '#3b82f6';
            } else { 
                grad.addColorStop(0, '#555'); grad.addColorStop(1, '#333'); 
                ctx.fillStyle = grad; ctx.strokeStyle = '#222';
            }
            roundRect(ctx, rod.x, rod.y, rod.w, rod.h, 15, true, true);
            ctx.fillStyle = 'white'; ctx.font='20px Arial';
            ctx.fillText(rod.charge>0?"++++++":"------", rod.x+70, rod.y+25);
            ctx.restore();

            if(isGrounded) {
                ctx.fillStyle = '#e67e22';
                ctx.beginPath(); ctx.arc(440, 180, 10, 0, Math.PI*2); ctx.fill();
                ctx.fillRect(440, 170, 60, 20); 
                ctx.fillStyle = 'white'; ctx.font='14px Arial'; ctx.fillText("æ¥åœ°", 460, 185);
            }

            requestAnimationFrame(draw);
        }

        setupInteractions(canvas, 
            (e, pos) => {
                if(currentExpId!==5) return;
                if(pos.x>rod.x && pos.x<rod.x+rod.w && pos.y>rod.y && pos.y<rod.y+rod.h) {
                    dragging = rod; dragOff = {x:pos.x-rod.x, y:pos.y-rod.y};
                }
            },
            (e, pos) => {
                if(!dragging || currentExpId!==5) return;
                dragging.x = pos.x - dragOff.x;
                dragging.y = pos.y - dragOff.y;
            },
            () => dragging = null
        );

        const btns = {
            glass: document.getElementById('btn-glass-e5'),
            plastic: document.getElementById('btn-plastic-e5'),
            neu: document.getElementById('btn-init-neu-e5'),
            pos: document.getElementById('btn-init-pos-e5'),
            neg: document.getElementById('btn-init-neg-e5')
        };

        function updateBtnState(group, activeId) {
            group.forEach(id => document.getElementById(id).classList.remove('active'));
            document.getElementById(activeId).classList.add('active');
        }

        btns.glass.onclick = () => { rod.type='glass'; rod.charge=1; updateBtnState(['btn-glass-e5','btn-plastic-e5'], 'btn-glass-e5'); };
        btns.plastic.onclick = () => { rod.type='plastic'; rod.charge=-1; updateBtnState(['btn-glass-e5','btn-plastic-e5'], 'btn-plastic-e5'); };
        
        btns.neu.onclick = () => { initialChargeState=0; initEParticles(); updateBtnState(['btn-init-neu-e5','btn-init-pos-e5','btn-init-neg-e5'], 'btn-init-neu-e5'); };
        btns.pos.onclick = () => { initialChargeState=1; initEParticles(); updateBtnState(['btn-init-neu-e5','btn-init-pos-e5','btn-init-neg-e5'], 'btn-init-pos-e5'); };
        btns.neg.onclick = () => { initialChargeState=-1; initEParticles(); updateBtnState(['btn-init-neu-e5','btn-init-pos-e5','btn-init-neg-e5'], 'btn-init-neg-e5'); };

        const fBtn = document.getElementById('btn-finger-e5');
        fBtn.addEventListener('mousedown', () => isGrounded=true);
        fBtn.addEventListener('mouseup', () => isGrounded=false);
        fBtn.addEventListener('touchstart', (e) => { e.preventDefault(); isGrounded=true; });
        fBtn.addEventListener('touchend', (e) => { e.preventDefault(); isGrounded=false; });

        document.getElementById('btn-reset-e5').onclick = () => { 
            rod.x=50; rod.y=150; 
            initialChargeState=0; initEParticles();
            updateBtnState(['btn-init-neu-e5','btn-init-pos-e5','btn-init-neg-e5'], 'btn-init-neu-e5');
        };

        requestAnimationFrame(draw);
    })();

</script>
</body>
</html>